using System;
using System.Collections.Generic;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Windows.Forms;
using Oracle.ManagedDataAccess.Client;
using model;
using System.Configuration;
using System.Drawing.Printing;
using NTwain;
using NTwain.Data;
using System.Reflection;
using System.Drawing.Imaging;
using System.Threading;
using System.Diagnostics;
using System.IO;
using iTextSharp.text.pdf;
using iTextSharp.text;
using System.Net;
using System.Drawing.Drawing2D;
using funciones;


namespace OrfeoScan_IDU_STRT
{
    public partial class ScanOrfeo : Form
    {
        //Variables de Scanner
        ImageCodecInfo _tiffCodecInfo;
        TwainSession _twain;
        bool _stopScan;
        bool _loadingCaps;
        List<System.Drawing.Image> imagenes = new List<System.Drawing.Image>();
        List<PictureBox> boxes = new List<PictureBox>();

        int numero_box = 0;
        bool btnAllSettings = false;
        private int HoJas;
        private string Inf_radicadoIMG1;
        private string Inf_radicadoIMG2;
        private string Inf_radicadoIMG3;
        private string numeroExpediente;
        private string espCodi;
        private string varFechaSistema = "";
        private string varIsNull = "";
        private bool Doc_Anexo;
        private int paginaActual = 0;

        //Variables de formularios
        funciones.funciones funciones = new funciones.funciones();
        RawPrinterHelper RawPrinterHelper = new RawPrinterHelper();
        private string varConcat = "";
        private string varSubstr = "";
        private string varRadi_Fech_radi = "";
        private USUARIO usuarioScanOrfeo;
        private string DEPRADICADO;
        Configuration config = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);
        private string DirTraB;
        string digitalizador_user = "digitalizador40";
        string digitalizador = "D1g1t4l#0129";
        int[] pageRange = new int[2] { 0, 2 };
        private int PrintPage = 0;
        private System.Drawing.Image codbarras_private;
        List<etiquetas> ListaEtiquetas = new List<model.etiquetas>();
        PrintDocument pdoc = null;

        private Bitmap actualBitmap = null;
        private Bitmap workingBitmap = null;
        private Bitmap actualBitmap1 = null;
        private Bitmap actualBitmap2 = null;
        private Bitmap actualBitmap3 = null;
        private int actualpage1 = 0;
        private int actualpage2 = 1;
        private int actualpage3 = 2;

        public List<System.Drawing.Image> TiffCarga = new List<System.Drawing.Image>();
        private string base64 = "Qk0igwAAAAAAADYAAAAoAAAAsQAAAD8AAAABABgAAAAAAOyCAADEDgAAxA4AAAAAAAAAAAAA////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////BAQEBAQEBAQEBAQEj4+P5OTk////////////////pKSkT09PBAQEBAQEBAQE////BAQEBAQEBAQEZGRkz8/P////z8/PT09PBAQEBAQEBAQEBAQE////////BAQEBAQE////////////BAQEBAQE////////////////mpqaBAQEBAQEmpqa////////////BAQEBAQE////////BAQEBAQE////////mpqaBAQEBAQEmpqa////////////////////////////pKSkT09PBAQET09PpKSk////////////BAQEBAQE////////////BAQEBAQEBAQEBAQEZGRk5OTk////////z8/PT09PBAQEBAQEBAQEBAQE////BAQEBAQE////////BAQEBAQE////////////mpqaBAQEBAQEmpqa////////////////////////////////////////////////////////////////AP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wQEBAQEBP///+/v73p6egQEBOTk5P///////6SkpAQEBLq6uv///////////////////////+/v7wQEBE9PT////09PTwQEBO/v78TExAQEBAQEBP///////wQEBAQEBP///////////wQEBAQEBP///////////5qamgQEBOTk5OTk5AQEBJqamv///////wQEBAQEBP///////wQEBAQEBP///5qamgQEBOTk5OTk5AQEBJqamv///////////////////5qamgQEBMTExP///8TExAQEBJqamv///////wQEBAQEBP///////////wQEBAQEBOTk5OTk5AQEBJqamv///////09PTwQEBO/v78TExAQEBAQEBP///wQEBAQEBP///////wQEBAQEBP///////5qamgQEBOTk5OTk5AQEBJqamv///////////////////////////////////////////////////////////wD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8EBAQEBAT////////k5OQEBAR6enr///////8EBAQEBAT////////////////////k5OSampoEBAQEBARkZGT///9PT08EBATk5OT///8EBAQEBAT///////8EBAQEBAT///////////8EBAQEBAT///////////8EBAQEBAT///////8EBAQEBAT///////8EBAQEBAT///////8EBAQEBAT///8EBAQEBAT///////8EBAQEBAT///////////////////8EBAQEBAT///////////8EBAQEBAT///////8EBAQEBAT///////////8EBAQEBAT///////8EBAQEBAT///////9PT08EBATk5OT///8EBAQEBAT///8EBAQEBAT///////8EBAQEBAT///////8EBAQEBAT///////8EBAQEBAT///////////////////////////////////////////////////////////8A////////////////////////////////////////////////////////////////////////////////////2sSv2sSv2sSv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////BAQEBAQE////////////BAQEBAQE////////BAQEBAQEBAQEBAQEBAQEBAQE////T09PBAQEZGRkr6+v7+/v////2traenp6BAQEBAQEBAQEBAQE////////BAQEBAQE////////////BAQEBAQE////////////BAQEBAQE////////BAQEBAQE////////BAQEBAQE////////BAQEBAQE////BAQEBAQE////////BAQEBAQE////////////////////BAQEBAQE////////////BAQEBAQE////////BAQEBAQE////////////BAQEBAQE////////BAQEBAQE////////2traenp6BAQEBAQEBAQEBAQE////BAQEBAQE////////BAQEBAQE////////BAQEBAQE////////BAQEBAQE////////////////////////////////////////////////////////////AP////////////////////////////////////////////////////////////////////////r6+trEr6RvRHovBHovBHovBJpvOtrEr/r6+v///////////////////////////////////////////////////////////////////////////////////////////////////////wQEBAQEBP///////////wQEBAQEBP///////6SkpAQEBOTk5OTk5AQEBI+Pj////09PT09PT+Tk5P///////////////////////+/v7wQEBGRkZP///////wQEBAQEBMTExP///////wQEBAQEBMTExP///////5qamgQEBOTk5OTk5AQEBJqamv///////wQEBAQEBP///////wQEBAQEBP///5qamgQEBOTk5OTk5AQEBJqamv///////////////////wQEBAQEBP///////////wQEBAQEBP///////wQEBAQEBMTExP///////wQEBAQEBOTk5OTk5AQEBJqamv///////////////////+/v7wQEBGRkZP///wQEBAQEBMTExOTk5AQEBE9PT////////5qamgQEBOTk5OTk5AQEBJqamv///////////////////////////////////////////////////////////wD////////////////////////////////6+vrv5Nrv5Nrk2sTk2sTk2sTaxK/Er4/Er4+vhFqPTyR6LwR6LwSERASERASERARvRBqERASETySvhFrEr4/Er4/axK/k2sTk2sTk2sTv5Nrv5Nr6+vr///////////////////////////////////////////////////////////////8EBAQEBAT////////k5OQEBAR6enr///////////+kpKQEBAQEBASPj4/k5OT////Pz89kZGQEBAQEBAQEBAT///////8EBAQEBAQEBAR6enrk5OT///////8EBAQEBAQEBAQEBAT///8EBAQEBAQEBAQEBAT///////+ampoEBAQEBASampr///////////8EBAQEBAT///////8EBAQEBAT///////+ampoEBAQEBASampr///////////////////////8EBAQEBAT///////////8EBAQEBAT///////8EBAQEBAQEBAQEBAT///8EBAQEBAQEBAQEBARkZGTk5OT///////////8EBAQEBAQEBAR6enrk5OT///8EBAQEBAQEBAQEBARPT0/Pz8////////////+ampoEBAQEBASampr///////////////////////////////////////////////////////////////8A////////////////////////+u/vr49vj08khEQEhEQEhEQEhEQEhEQEhEQEei8Eei8Eei8Eei8EL4+aGq+6L5qkWmRPWmRPT29kGq/ab0Qab0Qaei8Eei8Eei8Eei8EhEQEhEQEhEQEhEQEj08kr49v+u/v////////////////////////////////////////////////////////BAQEBAQE////7+/venp6BAQE5OTk////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////BAQEBAQE////////BAQEBAQE////////////////////////////////////////////////BAQEBAQE////////////BAQEBAQE////////////////////////////BAQEBAQE////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP////////////////////////rv76+Pb49PJIREBIREBIREBIREBIREBIREBHovBHovBHovBHovBC+Pmhqvui+apFpkT1pkT09vZBqv2m9EGm9EGnovBHovBHovBHovBIREBIREBIREBIREBI9PJK+Pb/rv7////////////////////////////////////////////////////////wQEBAQEBAQEBAQEBI+Pj+Tk5P///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wQEBAQEBP///////wQEBAQEBP///////////////////////////////////////////////wQEBAQEBP///////////wQEBAQEBP///////////////////////////wQEBAQEBP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD////////////////////k2sSETyRvLwR6LwRvRBpvRBqERAQ6hIRvRBqERASERASERARvRBpPb29Pb1qPLwREhHoar8Qar8RPenoar7okmrpPenqERASERASERARvRBo6hISERASERASERAR6LwRvLwSETyTk2sT///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8EBAQEBAT///////8EBAQEBAT///////////////////////////////////////////////////////////////////////////////////////////////////////8EBAQEBAT///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////////7+Ta7+TahEQEei8EjzoEb1ovGq+6Gq+6Gq/aRIR6jzoEhEQEhEQEhEQEZFo6Oo+PT29kL5qkOo+PWmRPWmRPjzoEjzoEhEQEhEQEhEQEhEQEhEQEjzoERIR6Gq/aGq+6Gq+6b1ovjzoEei8EhEQE7+Ta7+Ta////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////////6+EWq+EWm8vBI86BG9aJG9aJDqEhDqEhDqEhI86BIREBIREBIREBIREBIREBI86BG9aL096em9aJI86BI86BI86BIREBIREBIREBIREBIREBIREBIREBI86BESEejqEhDqEhG9aJG9aJI86BG8vBK+EWq+EWv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD////////67++ERASERASERARkWjovmqQar8RPenpPenqPLwSERASPOgSPOgSPOgSPOgSPOgSPOgSERARkZE8kmroar8Qar8RPb2RvRBqPOgSPOgSPOgSPOgSPOgSPOgSPOgSPOgRPenpPenoar88vmqRkWjqERASERASERAT67+////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8EBAQEBAT///////8EBAQEBAT///////8EBAQEBAT///////8EBAQEBAQEBARkZGTPz8////////+6uroEBAQEBAQEBAT///8EBAQEBAT///////+6uroEBAQEBAQEBAT////Pz89PT08EBAQEBAQEBAQEBAT///////+6uroEBAQEBAQEBAT///+ampoEBAQEBASampr///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////2s+6ei8Eei8EhEQEBLrkZFpEZFpEOoSEOoSEhEQEhEQET29kL4+aL4+aL4+aL4+aJJq6BLrkBNr6D2+ED09aD09aBNr6BLrkJJq6L4+aL4+aL4+aL4+aT29khEQEhEQEOoSEOoSEZGRPZFpEBLrkhEQEei8Eei8E2s+6////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////BAQEBAQE////////BAQEBAQE////////BAQEBAQE////////////////7+/vBAQET09P////////BAQEBAQE////////////BAQEBAQE////////BAQEBAQE////////////T09PBAQE5OTkxMTEBAQEBAQE////////BAQEBAQE////////mpqaBAQE5OTk5OTkBAQEmpqa////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////9rPunovBHovBIREBE96em9EGhqvz1pvWlpvWoREBBqvzwTa+gTa+gTP+gTP+g9k+gTP+gTP+gTP+g8kLxoEBBoEBASv2gTP+gTa+g9k+gSk+gSk+gTa+gTa+hqvxIREBFpvWlpvWhqvz29EGk9vb4REBHovBHovBNrEr////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wQEBAQEBP///////wQEBAQEBP///////wQEBAQEBP///////+Tk5JqamgQEBAQEBGRkZP///////wQEBAQEBP///////////wQEBAQEBP///////wQEBAQEBP///////////wQEBAQEBP///////wQEBAQEBP///////wQEBAQEBP///////wQEBAQEBP///////wQEBAQEBP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD////////az7p6LwR6LwSERARPenpvRBoar89ab1pab1qERAQar88E2voE2voEz/oEz/oPZPoEz/oEz/oEz/oPJC8aBAQaBAQEr9oEz/oE2voPZPoEpPoEpPoE2voE2voar8SERARab1pab1oar89vRBpPb2+ERAR6LwR6LwTaxK////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8EBAQEBAT///////8EBAQEBAT///////8EBAQEBAT///////9PT08EBARkZGSvr6/v7+////////8EBAQEBAT///////////8EBAQEBAT///////8EBAQEBAT///////////8EBAQEBAT///////8EBAQEBAT///////8EBAQEBAT///////8EBAQEBAT///////8EBAQEBAT///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////2s+6ei8Eei8Eb0QaOo+PT3p6T3p6hEQEhEQEJKS6BNr6BM/6BNr6BK/6BK/6Dy/kD3rvBM/6BM/6DyQkGgQEGgQEBK/aBNr6BKT6Dy/kD4/vD4/vBNr6BM/6BNr6L5qkjzoEjzoET3p6T3p6Oo+Pb0Qaei8Eei8E2sSv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////BAQEBAQE////////BAQEBAQExMTE5OTkBAQET09P////////T09PT09P5OTk////////////////BAQEBAQE////////////BAQEBAQE////////BAQEBAQE////////////BAQEBAQE////////BAQEBAQE////////BAQEBAQE////////mpqaBAQE5OTk5OTkBAQEmpqa////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////9rPunovBHovBIREBGRkRIREBJovBG9aL29aLwTP+gTP+gTP+gSEpBoaOhoaOg+P7w865A967wSEpA8kLxoaJBoaJA9kegSk+g8v5A+P7xovWhovWg9kegTP+gTP+gTP+m9EGm9EGpovBIREBGRkRIREBHovBHovBNrEr////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wQEBAQEBP///////wQEBAQEBAQEBAQEBE9PT8/Pz////////8/Pz2RkZAQEBAQEBAQEBP///wQEBAQEBAQEBAQEBAQEBP///wQEBAQEBP///wQEBAQEBAQEBAQEBAQEBP///wQEBAQEBP///////wQEBAQEBP///wQEBAQEBAQEBAQEBAQEBP///5qamgQEBAQEBJqamv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD////////az7p6LwR6LwSERASPOgSERASPOgRkZE9kZE8E2voEz/oPeu8aL1oaBAQaBAQPb4QEz/oEz/oPT28aBAQaGiQaGiQPJCQEr/oEr/oEmq8aBAQaBAQaGiQPb+8Er/oE2vpkWjpkWjqPOgSERASPOgSERAR6LwR6LwTaxK////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8EBAQEBAT///////////////////////////////////////////////////////////////////8EBAQEBAT///////////////////////////8EBAQEBAT///////////////////////////////////////////8EBAQEBAT///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////2s+6ei8Eei8EhEQEhEQEhEQEjzoEZGREZGREBK/6Gk/kD2/vGk/kD2/vD2/vD09aD0RPBJqvBG+PGhokGgQEGgQED09vBJqvD2R6Dy86BHq6BHq6Gk/kD2/vGk/kBKT6b2Qvb2QvjzoEhEQEhEQEhEQEei8Eei8E2sSv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////BAQEBAQE////////////////////////////////////////////////////////////////////BAQEBAQE////////////BAQEBAQE////////BAQEBAQE////////////////////////////////////////////BAQEBAQE////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////9rPunovBHovBI86BFpvWk9vZI8vBGRkRGRkRA9v7xpP5ATa+g967wSk+gSk+gTP+g8kLxoEBA8kLxoaJBoaJBoaJA8kLxoEBBoEBASv2gSv+gSv+g9a5ATa+g9v7w9a5GRkRGRkRI8vBE9vZFpvWo86BHovBHovBNrEr////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wQEBAQEBP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD////////az7p6LwR6LwSPOgRkZEREhHqaLwRkWkRkWkQEpPoEpPoEpPoaGtoEr/oEr/oE2voPZHoaBAQaBAQaGiQaGiQaGiQaGiQaBAQPLzoEz/oEz/oEz/oaGtoPeu8EpPoEpPpkWjpkWjqaLwREhHpaZE+POgR6LwR6LwTaxK////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////2s+6ei8Eei8EjzoEZFpEGq/PZFpEb2Qvb2QvD4/vD1rkD3rvBKT6BM/6BM/6BLrkBK/aBISkDy86GhokGhokGhokDyQvD2R6BK/aBLrkBM/6BM/6BKT6D3rvD1rkD3rvb2Qvb2QvZFpEGq/PZFpEjzoEei8Eei8E2sSv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////9rPunovBHovBI86BGRaRBqvz2RaRG9kL29kLw+P7w9a5A967wSk+gTP+gTP+gS65ASv2gSEpA8vOhoaJBoaJBoaJA8kLw9kegSv2gS65ATP+gTP+gSk+g967w9a5A96729kL29kL2RaRBqvz2RaRI86BHovBHovBNrEr////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD////////az7p6LwR6LwSPLwRPenpPenovmqRkWkRkWkQEr/oEpPoEz/oE2voE2voE2voEuuQPLzoPLzoEb48PJC8aBAQaBAQPZHoPZHoaGiQEj68E2voE2voE2voE2voEr/oEr/pkZERkZEQvmqREhHpPenqPLwR6LwR6LwTaxK////////////////////////////////////////////8EBAQEBAQEBAQEBAR6enra2tr///////////8EBAQEBAQEBAQEBAQEBAQEBAT///////////////////////////8EBAQEBAQEBAQEBAQEBASampr////////////////k5OSampoEBAQEBASamprk5OT///////////////////+kpKRPT08EBARPT0+amprPz8/////////////////k5OSampoEBAQEBASamprk5OT///////////////////8EBAQEBAT///////////////9kZGQEBATk5OT////////////k5OQEBARkZGT///////////////////8EBAQEBAQEBAQEBAR6enra2tr///////////8EBAQEBAT///////////////+kpKQEBAQEBARkZGS6urr///////8EBAQEBAT///////////////////////////////////////////////////////////8A////////2s+6ei8Eei8ET29kGq/PT3p6jzoEb2Qvb2QvBM/6BM/6BM/6BI+vD09vD09vD2R6D2+EGgQEGgQEGhokGhokGhokGhokGgQED09aBISkD09vD09vBG+PBLrkBM/6BM/6ZFo6ZFo6jzoET3p6Gq/PT29kei8Eei8E2sSv////////////////////////////////////////////BAQEBAQE////////mpqaBAQE5OTk////////BAQEBAQE////////////////////////////////////////////BAQEBAQE////////z8/PBAQEpKSk////////7+/vT09PZGRk7+/v7+/vZGRkT09P7+/v////////////enp6T09P5OTk////xMTEBAQEBAQE////////////7+/vT09PZGRk7+/v7+/vZGRkT09P7+/v////////////////BAQEBAQE////////////////r6+vBAQExMTE////////////xMTEBAQEr6+v////////////////////BAQEBAQE////////mpqaBAQE5OTk////////BAQEBAQE////////////T09PZGRk7+/v////xMTEBAQEj4+P////BAQEBAQE////////////////////////////////////////////////////////////AP///////9rEr3ovBHovBC+apGRaRDqPj2RaRG9aJG9aJATP+gTP+gTP+gSv2g9vhA9vhBoaJBoEBBoaJBoaJBoaJBoaJBoaJBoaJBoaJBoaJBoEBA9ETw9ETwSarwTP+gTP+gTP+mRaOmRaOmRaOjqPj2RaRC+apHovBHovBNrEr////////////////////////////////////////////wQEBAQEBP///////9ra2gQEBKSkpP///////wQEBAQEBP///////////////////////////////////////////wQEBAQEBP///////////wQEBAQEBP///////6SkpAQEBM/Pz////////8/PzwQEBKSkpP///////7q6ugQEBM/Pz////////////wQEBAQEBP///////////6SkpAQEBM/Pz////////8/PzwQEBKSkpP///////////////wQEBAQEBP///////////////+Tk5AQEBAQEBAQEBAQEBAQEBAQEBAQEBOTk5P///////////////////wQEBAQEBP///////9ra2gQEBKSkpP///////////////////////6+vrwQEBNra2v///////////////////////////////////////////////////////////////////////////////////////////wD////////axK9vRBpvRBoEuuSPOgQvj5o6hIRvRBpvRBoEz/oEz/oEmq8PT28PRE8PRE8PLzoaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQPZHoPZHoPb4QEj68EuuQEz/pvWi9vWi86hIQvj5qPOgQEuuRvRBpvRBraxK////////////////////////////////////////////8EBAQEBAT///////////8EBARPT0////////8EBAQEBAT///////////////////////////////////////////8EBAQEBAT///////////8EBAQEBAT///////9kZGQEBAT///////////////8EBARkZGT///////96enoEBATv7+////////////8EBAQEBAT///////////9kZGQEBAT///////////////8EBARkZGT///////////////8EBAQEBAT///////////////////9kZGQEBATv7+////////8EBARkZGT///////////////////////8EBAQEBAT///////////8EBARPT0////////////////////////9kZGQEBAT///////////////////////////////////////////////////////////////////////////////////////////////8A////////2s+6ei8Eei8EWm9aT29vT3p6hEQEb1ovb1ovBM/6BK/aD0RPGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGgQEGgQEGgQEDy86BISkBNr6ZFpEZFpEhEQET29vT29vWm9aei8Eei8E2sSv////////////////////////////////////////////BAQEBAQE////////////BAQEBAQE////////BAQEBAQE////////////////////////////////////////////BAQEBAQE////////xMTEBAQEenp6////////BAQEBAQE////////////////BAQEBAQE////////BAQEBAQE////////BAQEBAQEBAQEBAQE////////////BAQEBAQE////////////////BAQEBAQE////////////////BAQEBAQE////////////////////pKSkBAQEz8/P////z8/PBAQEr6+v////////////////////////BAQEBAQE////////////BAQEBAQE////////////////////////BAQEBAQE////////////////////////////////////////////////////////////////////////////////////////////////AP///////9rPunovBHovBI8vBDqPj09vZI8vBG9aL29aLwTP+gTa+gS65A9vhA8kLw8kLxoaJBoaJBoaJBoaJBoaJBoaJBoaJBoaJBoaJBoaJBoaJBoaJBoaJA9PbwSv2gTa+gTa+mRkRGRkRI8vBE9vZDqPj48vBHovBHovBNrEr////////////////////////////////////////////wQEBAQEBP///////////wQEBAQEBP///////wQEBAQEBAQEBAQEBAQEBAQEBP///////////////////////////wQEBAQEBAQEBAQEBAQEBHp6eu/v7////////wQEBAQEBP///////////////wQEBAQEBP///////wQEBAQEBP///////////////////////////////////wQEBAQEBP///////////////wQEBAQEBP///////////////wQEBAQEBP///////////////////9ra2gQEBJqamv///5qamgQEBNra2v///////////////////////wQEBAQEBP///////////wQEBAQEBP///////////////////////wQEBAQEBP///////////////////////////////////////////////////////////////////////////////////////////////wD////////az7p6LwR6LwSERASERASERASPOgRvWi9vWi8E2voEhKQaBAQaBAQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaGiQaBAQaBAQPT1oEz/pkZERkZESPOgSERASERASERAR6LwR6LwTaxK////////////////////////////////////////////8EBAQEBAT///////////8EBARkZGT///////8EBAQEBAT///////////////////////////////////////////8EBAQEBAT////////k5OQEBASvr6////////9kZGQEBAT///////////////8EBARkZGT///////9kZGQEBAT///////////////////////////////////9kZGQEBAT///////////////8EBARkZGT///////////////8EBAQEBAT///////////////////////9PT08EBATv7+8EBARPT0////////////////////////////8EBAQEBAT///////////8EBARkZGT///////////////////////96enoEBAT///////////////////////////////////////////////////////////////////////////////////////////////8A////////2s+6ei8Eei8EhEQEhEQEhEQEjzoEb1ovb1ovBNr6BISkGgQEGgQEGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGhokGgQEGgQED09aBM/6ZGREZGREjzoEhEQEhEQEhEQEei8Eei8E2sSv////////////////////////////////////////////BAQEBAQE////////5OTkBAQEpKSk////////BAQEBAQE////////////////////////////////////////////BAQEBAQE////////////BAQEBAQE////////pKSkBAQEz8/P////////2traBAQEpKSk////////r6+vBAQEz8/P////////////////////////////////pKSkBAQEz8/P////////2traBAQEpKSk////////////////BAQEBAQE////////////////////////pKSkBAQEj4+PBAQEpKSk////////////////////////////BAQEBAQE////////5OTkBAQEpKSk////////////////////////urq6BAQE2tra////////////////////////////////////////////////////////////////////////////////////////////AP///////9rPunovBHovBIREBIREBIREBIREBG9kL29kLwSv2hoaJA9ETw9ETxoaJBoaJBoaJBoEBASEpASv2hoaJBoEBBoEBA9vhAS65A8kLxoaJBoaJBoaJA8vOg9ETxoaJARvj09vWk9vWo86BIREBIREBIREBHovBHovBNrEr////////////////////////////////////////////wQEBAQEBP///////5qamgQEBOTk5P///////wQEBAQEBP///////////////////////////////////////////wQEBAQEBP///////+Tk5AQEBGRkZP///////+/v709PT3p6eu/v7+/v73p6ek9PT+/v7////////////3p6emRkZOTk5P///8TExAQEBI+Pj////////////+/v709PT3p6eu/v7+/v73p6ek9PT+/v7////////////////wQEBAQEBP///////////////////////9ra2gQEBAQEBAQEBNra2v///////////////////////////wQEBAQEBP///////5qamgQEBOTk5P///////////////////////////3p6emRkZO/v7////8TExAQEBI+Pj////////////////////////////////////////////////////////////////////////wD////////az7p6LwR6LwSERARvRBpvRBqPOgRvWi9vWi8EuuQEz/oEr9oPRE8aGiQaGiQaGiQaGiQEz/oE2voPJC8aBAQaBAQEmq8E2voPT28aBAQaGiQaGiQPLzoEj68Ez/oEuuRaZE9aZE+PLwRvRBpvRBqERAR6LwR6LwTaxK////////////////////////////////////////////8EBAQEBAQEBAQEBARkZGTa2tr///////////8EBAQEBAQEBAQEBAQEBAQEBAT///////////////////////////8EBAQEBAQEBAQEBAQEBAR6enrk5OT////////////k5OSampoEBAQEBASamprk5OT///////////////////+kpKRPT08EBARPT0+kpKT////////////////////k5OSampoEBAQEBASamprk5OT///////8EBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAT///////////////8EBAQEBAQEBAT///////////////////////////////8EBAQEBAQEBAQEBARkZGTa2tr///////////////////////////////////+kpKRPT08EBARkZGSkpKT///////////////////////////////////////////////////////////////////////////8A////////2s+6ei8Eei8Ejy8ET29vT3p6jy8Eb1okb1okBNr6BK/aGhokGgQEGgQEGgQEGhokBI+vBM/6BK/aDyQvGgQEGgQEBJqvBNr6BLrkDy86GgQEGgQEGgQEGgQEBG+PBNr6WmRPWmRPmi8ERIR6T29vjy8Eei8Eei8E2sSv////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AP///////9rPunovBHovBGRkRBqvuk96eo8vBG9aJG9aJATP+g8kLxoEBA9ETwSEpASEpAS65ATa+gSv2hoEBA9PbxoaJBoaJASv2gTP+gTP+gTP+gSarwSarw9PbxoaJBoEBASv2k9vZE9vZJovBE96ehqvumRkRHovBHovBNrEr////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////4+Pj6SkpP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD////////axK96LwR6LwQ6hIQar7pvZC+PLwRvZC9vZC8Emq8PLzoEmq8Ez/oEz/oEz/oEz/oEz/oEz/oEj68PT28PT28PT28EuuQEz/oEz/oEz/oEz/oEz/oE2voEuuQPT1oPb4RPb2RPb2SPLwRvZC8kpLo6hIR6LwR6LwTaxK/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////k5OQEBASkpKT///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A////////2s+6ei8Eei8EhEQEL4+aZFo6jzoEb1okb1okBLrkBM/6BNr6BM/6BM/6BM/6BM/6BM/6BNr6BK/aD0RPDy86Dy86BI+vBNr6BM/6BM/6BM/6BM/6BM/6BM/6BNr6BLrkT29aT29ajzoEZFo6Oo+PhEQEei8Eei8E2sSv////////////////////ZGRkBAQE5OTk////////////5OTkBAQEZGRk////BAQEBAQEBAQEBAQEBAQEBAQE////////////////pKSkBAQEBAQEZGRkurq6////////ZGRkBAQE5OTk////////////5OTkBAQEZGRk////BAQEBAQEBAQEBAQEBAQEBAQE////////////BAQEBAQEBAQEBAQEenp62tra////////////BAQEBAQE////ZGRkBAQE5OTk////////////5OTkBAQEZGRk////////////////////BAQEBAQE////xMTEBAQExMTE////BAQEBAQE////////ZGRkBAQE5OTk////////////5OTkBAQEZGRk////////////////BAQEBAQE////////////////////5OTkmpqaBAQEBAQEmpqa5OTk////////////////BAQEBAQE////////////urq6BAQEj4+P////////////////////////////////AP///////9rPunovBHovBIREBC+PmmRaOo86BG9aJG9aJAS65ATP+gTa+gTP+gTP+gTP+gTP+gTP+gTa+gSv2g9ETw8vOg8vOgSPrwTa+gTP+gTP+gTP+gTP+gTP+gTP+gTa+gS65E9vWk9vWo86BGRaOjqPj4REBHovBHovBNrEr////////////////////6+vrwQEBMTExP///////////8TExAQEBK+vr////wQEBAQEBP///////////////////////////09PT2RkZO/v7////8TExAQEBI+Pj////6+vrwQEBMTExP///////////8TExAQEBK+vr////wQEBAQEBP///////////////////////////wQEBAQEBP///////5qamgQEBOTk5P///////wQEBAQEBP///6+vrwQEBMTExP///////////8TExAQEBK+vr////////////////////wQEBAQEBP///6SkpAQEBKSkpP///wQEBAQEBP///////6+vrwQEBMTExP///////////8TExAQEBK+vr////////////////wQEBAQEBP///////////////+/v709PT2RkZO/v7+/v72RkZE9PT+/v7////////////wQEBAQEBP///////////09PTwQEBO/v7////////////////////////////////wD////////axK96LwR6LwQvj5oar7o6j4+ERARvRBpvRBpEhHpkZERvWi9kWkRkZE9kZE9kZE9aZE86hIQar8QEz/oEuuQEuuQar9ovj5pPb2RaZE9kZE9kZE9kZE9kWjpkWkREhHpkWjpkWjqPOgQ6j48kmrovj5p6LwR6LwTaxK/////////////////////k5OQEBAQEBAQEBAQEBAQEBAQEBAQEBATk5OT///8EBAQEBAT///////////////////////+vr68EBATa2tr////////////////////////k5OQEBAQEBAQEBAQEBAQEBAQEBAQEBATk5OT///8EBAQEBAT///////////////////////////8EBAQEBAT////////a2toEBASkpKT///////8EBAQEBAT////k5OQEBAQEBAQEBAQEBAQEBAQEBAQEBATk5OT///////////////////8EBAQEBAT///9kZGQEBARkZGT///8EBAQEBAT////////k5OQEBAQEBAQEBAQEBAQEBAQEBAQEBATk5OT///////////////8EBAQEBAT///////////////+kpKQEBATPz8/////////Pz88EBASkpKT///////////8EBAQEBAT///////+6uroEBASvr6////////////////////////////////////8A////////2sSvb0Qab0QaGq+6jzoEL5qkT3p6jzoEjzoEjy8Ejy8Eb0QaJKS6b0Qab0QajzoEZGREhEQEjy8EZGRET29kT29khEQEjy8Eb1okjzoEjzoEjzoEjzoEmi8Emi8Emi8Ejy8Ejy8ET3p6L5qkjy8EGq+6b0Qab0Qa2sSv////////////////////////ZGRkBAQE7+/v////////BAQEZGRk////////BAQEBAQE////////////////////////ZGRkBAQE////////////////////////////////ZGRkBAQE7+/v////////BAQEZGRk////////BAQEBAQE////////////////////////////BAQEBAQE////////////BAQET09P////////BAQEBAQE////////ZGRkBAQE7+/v////////BAQEZGRk////////////////////////BAQEBAQE////BAQEZGRkBAQE////BAQEBAQE////////////ZGRkBAQE7+/v////////BAQEZGRk////////////////////BAQEBAQE////////////////ZGRkBAQE////////////////BAQEZGRk////////////BAQEBAQE////5OTkBAQEenp6////////////////////////////////////////AP///////9rEr29EGm9EGhqvxG9EGi+apE9vWo8vBI8vBDqEhDqPjxqvxDqPj09vb09vbzqPjySkujqPj29aJIREBI86BI86BIREBDqEhBqv2jqPj09vWk9vWm9EGk9vbzqPj096eo8vBI8vBE9vWi+Pmm9EGhqvxG9EGm9EGtrEr////////////////////////6SkpAQEBM/Pz////8/PzwQEBK+vr////////wQEBAQEBP///////////////////////wQEBAQEBP///////////////////////////////6SkpAQEBM/Pz////8/PzwQEBK+vr////////wQEBAQEBP///////////////////////////wQEBAQEBP///////////wQEBAQEBP///////wQEBAQEBP///////6SkpAQEBM/Pz////8/PzwQEBK+vr////////////////////////wQEBAQEBOTk5AQEBM/PzwQEBOTk5AQEBAQEBP///////////6SkpAQEBM/Pz////8/PzwQEBK+vr////////////////+Tk5AQEBAQEBOTk5P///////////wQEBAQEBP///////////////wQEBAQEBP///////////wQEBAQEBAQEBAQEBAQEBI+Pj////////////////////////////////////////wD////////az7p6LwR6LwRvRBovj5pPb1qPOgSERASERARvRBpvRBpvWiRPb1oar9oar9pPb2+aLwRkWjokmrpvWi9vWi9vWi8kmrpkWkSaLwRPb1oar88ar89PenoEz/pPenpvWiSERASERASPOgRab1o6j49vRBp6LwR6LwTaxK/////////////////////////a2toEBASampr///+ampoEBATa2tr///////8EBAQEBAT///////////////////////8EBAQEBAT////////////////////////////////a2toEBASampr///+ampoEBATa2tr///////8EBAQEBAT///////////////////////////8EBAQEBAT///////////8EBAQEBAT///////8EBAQEBAT////////a2toEBASampr///+ampoEBATa2tr///////////////////////8EBAQEBAS6uroEBAT///8EBAS6uroEBAQEBAT////////////a2toEBASampr///+ampoEBATa2tr///////////////+Pj48EBAQEBASPj4////////////8EBAQEBAT///////////////8EBAQEBAT///////////8EBAQEBAT////////ExMQEBASampr///////////////////////////////////8A////////2s+6ei8Eei8EjzoET29kZFo6hEQEhEQEhEQEei8Eei8Eei8Ejy8ET29aT29aL4+aGq/PRIR6b0QahEQEhEQEhEQEb1okRIR6JKS6L4+aRHpvRHpvei8ERIR6ei8Eei8Eei8Eei8EhEQEZFo6T29khEQEei8Eei8E2sSv////////////////////////////T09PBAQE7+/vBAQET09P////////////BAQEBAQE////////////////////////enp6BAQE////////////////////////////////////T09PBAQE7+/vBAQET09P////////////BAQEBAQE////////////////////////////BAQEBAQE////////////BAQEZGRk////////BAQEBAQE////////////T09PBAQE7+/vBAQET09P////////////////////////////BAQEBAQEj4+Pj4+P////j4+Pj4+PBAQEBAQE////////////////T09PBAQE7+/vBAQET09P////////////////z8/PBAQEpKSkpKSkBAQEz8/P////////ZGRkBAQE////////////////BAQEZGRk////////////BAQEBAQE////////////BAQEBAQE////////////////////////////////////AP///////9rPunovBHovBHovBHovBHovBIREBI9aJI9aJJpvOqRvRKRvRJpvOo9PJI9PJIREBG9EGnovBIREBIREBIREBIREBIREBIREBE9PT29EGo9PJI9PJJpvOppvOqRvRJpvOo9aJI9aJIREBHovBHovBHovBHovBHovBNrEr////////////////////////////6SkpAQEBI+PjwQEBKSkpP///////////wQEBAQEBP///////////////////////7q6ugQEBNra2v///////////////////////////////6SkpAQEBI+PjwQEBKSkpP///////////wQEBAQEBP///////////////////////////wQEBAQEBP///////+Tk5AQEBKSkpP///////wQEBAQEBP///////////6SkpAQEBI+PjwQEBKSkpP///////////////////////////wQEBAQEBE9PT7q6uv///7q6uk9PTwQEBAQEBP///////////////6SkpAQEBI+PjwQEBKSkpP///////////////09PT09PT////////09PT09PT////////6SkpAQEBM/Pz////////9ra2gQEBKSkpP///////////wQEBAQEBP///////////wQEBAQEBP///////////////////////////////////wD////////axK9vLwRvLwSPTySvj2/axK/v5Nr6+vr6+vr////////////////6+vr6+vrv2s/ar5qvhFqETyRvLwRvLwRvLwSERASvhFrar5rv2s/6+vr6+vr////////////////////////v5NraxK+vj2+PTyRvLwRvLwTaxK/////////////////////////////a2toEBAQEBAQEBATa2tr///////////8EBAQEBAT///////////////////////////96enpkZGTv7+/////ExMQEBASPj4/////////////a2toEBAQEBAQEBATa2tr///////////8EBAQEBAT///////////////////////////8EBAQEBAT///////+ampoEBATk5OT///////8EBAQEBAT////////////a2toEBAQEBAQEBATa2tr///////////////////////////8EBAQEBAQEBATa2tr////a2toEBAQEBAQEBAT////////////////a2toEBAQEBAQEBATa2tr///////////+vr68EBATExMT////////ExMQEBASvr6/////v7+9PT096enrv7+/v7+96enpPT0/v7+////////////8EBAQEBAT////////a2toEBASampr///////////////////////////////////8A////////2sSvby8Eby8Ej08kr49v2sSv7+Ta+vr6+vr6////////////////+vr6+vr679rP2q+ar4RahE8kby8Eby8Eby8EhEQEr4Ra2q+a79rP+vr6+vr6////////////////////////7+Ta2sSvr49vj08kby8Eby8E2sSv////////////////////////////////BAQEBAQEBAQE////////////////BAQEBAQE////////////////////////////////pKSkT09PBAQEZGRkpKSk////////////////////BAQEBAQEBAQE////////////////BAQEBAQE////////////////////////////BAQEBAQEBAQEBAQEZGRk2tra////////////BAQEBAQE////////////////BAQEBAQEBAQE////////////////////////////////BAQEBAQEBAQE////////////BAQEBAQEBAQE////////////////////BAQEBAQEBAQE////////////5OTkBAQEenp6////////////////enp6BAQE5OTk////5OTkmpqaBAQEBAQEmpqa5OTk////////////////BAQEBAQEBAQEBAQEBAQEj4+P7+/v////////////////////////////////////AP///////+TaxM+vms+vmvr6+v////////////////////////////////////////////////////////rv78Skj8Skj8Skj/rv7/////////////////////////////////////////////////////////r6+s+vms+vmuTaxP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+Pj4+kpKT///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8A";
        private string rutaTiff = "";
        string pref_pag = "PAG ";
        string path_ = null;


        private void limpiar_imagen()
        {
            if (actualBitmap!=null)
            {
                actualBitmap.Dispose();
            }
            if (workingBitmap != null)
            {
                workingBitmap.Dispose();
            }
            if (actualBitmap1 != null)
            {
                actualBitmap1.Dispose();
            }
            if (actualBitmap2 != null)
            {
                actualBitmap2.Dispose();
            }
            if (actualBitmap3 != null)
            {
                actualBitmap3.Dispose();
            }

            actualBitmap = null;
            workingBitmap = null;
            actualBitmap1 = null;
            actualBitmap2 = null;
            actualBitmap3 = null;
            actualpage1 = 0;
            actualpage2 = 1;
            actualpage3 = 2;
            rutaTiff = "";
            path_ = "";
            lblScreen1.Text = "";
            lblScreen2.Text = "";
            lblScreen3.Text = "";
            txtPage.Text = "";
            pageRange[0] = 0;
            pageRange[1] = 2;
            PageScreen1.Image = null;
            PageScreen2.Image = null;
            PageScreen3.Image = null;
            PageEdit.Image = null;
            garbage_collector();
        }


        public void TiffImage(string path)
        {
            this.path_ = path;
            this.actualBitmap = (Bitmap)System.Drawing.Image.FromFile(path);
        }
        public int numeroPaginas()
        {
            return this.actualBitmap.GetFrameCount(System.Drawing.Imaging.FrameDimension.Page);
        }
        public Bitmap GetImagenActual()
        {
            return this.actualBitmap;
        }
        public Bitmap GetThumbnail(int pageNo, Size viewport)
        {
            actualBitmap.SelectActiveFrame(System.Drawing.Imaging.FrameDimension.Page, pageNo);
            Size imageSize = actualBitmap.Size;
            double dw = ((double)imageSize.Width / viewport.Width);
            double dh = ((double)imageSize.Height / viewport.Height);
            double scale = dw;
            if (dh > dw) scale = dh;
            int scaledWidth = (int)(imageSize.Width / scale);
            int scaledHeight = (int)(imageSize.Height / scale);
            int xShift = (viewport.Width - scaledWidth) / 2;
            int yShift = (viewport.Height - scaledHeight) / 2;
            Bitmap viewportBitmap = new Bitmap(viewport.Width, viewport.Height);
            Bitmap bitmap = new Bitmap(actualBitmap, scaledWidth, scaledHeight);
            using (Graphics graphics = Graphics.FromImage(viewportBitmap))
            {
                graphics.DrawImage(bitmap, xShift, yShift);
            }
            garbage_collector();
            return viewportBitmap;
        }
        public Bitmap GetWorkingImage(Size viewSize)
        {
            if (this.workingBitmap != null)
                return this.workingBitmap;

            //if (this.zoomMode == ZoomMode.FitWidth)
            //{
            //    Size imageSize = GetActualImage().Size;
            //    this.zoom = (double)viewSize.Width / imageSize.Width;
            //}
            //else if (this.zoomMode == ZoomMode.FitImage)
            //{
            //    Size imageSize = GetActualImage().Size;
            //    double hZoom = (double)viewSize.Width / imageSize.Width;
            //    double vZoom = (double)viewSize.Height / imageSize.Height;
            //    if (vZoom > hZoom)
            //        this.zoom = hZoom;
            //    else
            //        this.zoom = vZoom;
            //}
            double zoom = 1;
            this.workingBitmap = new Bitmap(this.actualBitmap,
                new Size((int)(this.actualBitmap.Width * zoom), (int)(this.actualBitmap.Height * zoom)));
            garbage_collector();
            return this.workingBitmap;
            
        }
        public Bitmap GetWorkingImage1(Size viewSize, int page)
        {
            if (actualBitmap!=null)
            {
                actualBitmap.SelectActiveFrame(System.Drawing.Imaging.FrameDimension.Page, page);
            }
            double zoom = 1;
            this.workingBitmap = new Bitmap(this.actualBitmap,
                new Size((int)(this.actualBitmap.Width * zoom), (int)(this.actualBitmap.Height * zoom)));
            garbage_collector();
            return this.workingBitmap;
        }
        private void button11_Click(object sender, EventArgs e)
        {
            OpenFileDialog dialog = new OpenFileDialog();
            dialog.Filter = "Archivos de Imagen (*.tif, *.tiff) | *.tif; *.tiff";
            dialog.InitialDirectory = @"C:\";
            dialog.Title = "Abrir Imagen";

            if (dialog.ShowDialog() == DialogResult.OK)
            {
                rutaTiff = dialog.FileName;
                TiffImage(rutaTiff);
                if (actualBitmap!=null)
                {
                    this.workingBitmap = GetWorkingImage(GetViewSize());
                    this.PageEdit.Image = workingBitmap;
                    actualBitmap1 = GetThumbnail(0, new Size(100, 100));
                    actualBitmap2 = GetThumbnail(1, new Size(100, 100));
                    actualBitmap3 = GetThumbnail(2, new Size(100, 100));
                    PageScreen1.Image = actualBitmap1;
                    PageScreen2.Image = actualBitmap2;
                    PageScreen3.Image = actualBitmap3;
                }
                //this.tiffViewer1.Path = rutaTiff;
                //cargarImagen0(pageRange, true, rutaTiff);
            }
            garbage_collector();
        }
        public Size GetViewSize()
        {
            return this.PageEdit.Size;
        }
        private void garbage_collector()
        {
            GC.Collect();
            GC.WaitForPendingFinalizers();
        }
        private void PageScreen1_Click(object sender, EventArgs e)
        {
            this.workingBitmap = GetWorkingImage1(GetViewSize(), actualpage1);
            this.PageEdit.Image = workingBitmap;
            garbage_collector();
        }
        private void PageScreen2_Click(object sender, EventArgs e)
        {
            this.workingBitmap=GetWorkingImage1(GetViewSize(), actualpage2);
            this.PageEdit.Image = workingBitmap;
            garbage_collector();
        }
        private void PageScreen3_Click(object sender, EventArgs e)
        {
            this.workingBitmap = GetWorkingImage1(GetViewSize(), actualpage3);
            this.PageEdit.Image = workingBitmap;
            garbage_collector();
        }
        private void btnPrevScreen_Click(object sender, EventArgs e)
        {
            if (pageRange[0] != 0)
            {
                pageRange[0]--;
                pageRange[1]--;
                actualpage1= pageRange[0];
                actualpage2 = pageRange[0]+1;
                actualpage3 = pageRange[0]+2;
                txtPage.Text = (pageRange[0] + 1).ToString();
                cargarImagen0();
            }
            else
            {
                actualpage1 = 0;
            }
        }
        private void btnNextScreen_Click(object sender, EventArgs e)
        {
            Guid objGuid = actualBitmap.FrameDimensionsList[0];
            FrameDimension dimension = new FrameDimension(objGuid);
            int noOfPages = actualBitmap.GetFrameCount(dimension);

            if (pageRange[1] < noOfPages)
            {
                pageRange[0]++;
                pageRange[1]++;
                actualpage1 = pageRange[0];
                actualpage2 = pageRange[0] + 1;
                actualpage3 = pageRange[0] + 2;
                txtPage.Text = (pageRange[0] + 1).ToString();
                cargarImagen0();
            }
        }
        private void cargarImagen0()
        {
            this.workingBitmap = GetWorkingImage1(GetViewSize(), actualpage1);
            this.PageEdit.Image = workingBitmap;
            actualBitmap1 = GetThumbnail(actualpage1, new Size(100, 100));
            actualBitmap2 = GetThumbnail(actualpage2, new Size(100, 100));
            actualBitmap3 = GetThumbnail(actualpage3, new Size(100, 100));
            PageScreen1.Image = actualBitmap1;
            PageScreen2.Image = actualBitmap2;
            PageScreen3.Image = actualBitmap3;
            garbage_collector();
        }


        public ScanOrfeo(USUARIO usuario)
        {
            usuarioScanOrfeo = usuario;
            InitializeComponent();
            foreach (var enc in ImageCodecInfo.GetImageEncoders())
            {
                if (enc.MimeType == "image/tiff") { _tiffCodecInfo = enc; break; }
            }
        }
        private void ScanOrfeo_Load(object sender, EventArgs e)
        {
            limpiar_imagen();
            ToolTip toolTip1 = new ToolTip();
            toolTip1.AutoPopDelay = 5000;
            toolTip1.InitialDelay = 1000;
            toolTip1.ReshowDelay = 500;
            // Force the ToolTip text to be displayed whether or not the form is active.
            toolTip1.ShowAlways = true;

            toolTip1.SetToolTip(this.btnStopScan, "Detener Captura");
            toolTip1.SetToolTip(this.btnStartCapture, "Iniciar Captura");
            toolTip1.SetToolTip(this.cBoxtRadicado, "Elija el Tipo de Radicado");
            toolTip1.SetToolTip(this.button2, "Imprimir Etiquetas");
            toolTip1.SetToolTip(this.btnNextScreen, "Siguiente Página");

            toolTip1.SetToolTip(this.btnPrevScreen, "Anterior Página");
            toolTip1.SetToolTip(this.btnBorrarSeleccion, "Borrar Selección");
            toolTip1.SetToolTip(this.btnGirarDerecha, "Girar Página 90° a la Derecha");
            toolTip1.SetToolTip(this.btnGirarIzquierda, "Girar Página 90° a la Izquierda");
            toolTip1.SetToolTip(this.btnEnviarPDF1, "Enviar Archivo");



            limpiar_anexos();
            cBoxtRadicado_load();
            int index_cBoxtRadicado = 0;
            foreach (var item in cBoxtRadicado.Items)
            {
                if (item.ToString() == "Entrada")
                {
                    cBoxtRadicado.SelectedIndex = index_cBoxtRadicado;
                }
                index_cBoxtRadicado++;
            }
            varConcat = "||";
            varSubstr = "substr";
            varRadi_Fech_radi = "TO_CHAR(a.RADI_FECH_RADI,'YYYYMM')";
            varFechaSistema = "sysdate";
            varIsNull = "nvl";
            DirTraB = config.AppSettings.Settings["DPATH"].Value;

            SetupTwain();
            foreach (var src in _twain)
            {
                var srcBtn = new ToolStripMenuItem(src.Name);
                srcBtn.Tag = src;
                srcBtn.Click += SourceMenuItem_Click;
                srcBtn.Checked = _twain.CurrentSource != null && _twain.CurrentSource.Name == src.Name;
                seleccionarEscanerToolStripMenuItem.DropDownItems.Insert(0, srcBtn);
            }
            bool primerEscaner = true;

            foreach (var btn in seleccionarEscanerToolStripMenuItem.DropDownItems)
            {
                if (primerEscaner)
                {
                    var srcBtn = btn as ToolStripMenuItem;
                    var src = srcBtn.Tag as DataSource;
                    if (src.Open() == ReturnCode.Success)
                    {
                        srcBtn.Checked = true;
                        btnStartCapture.Enabled = true;
                        LoadSourceCaps();
                    }
                }
                primerEscaner = false;
            }
        }
        private void limpiar_anexos()
        {
            DateTime fechaAnexo = DateTime.Now.AddDays(1);
            dtFechaAnexo.Value = fechaAnexo;
            dtHoraAnexo.Value = fechaAnexo;
            txtObservaciones.Text = string.Empty;
            cBoxtDocumento.Items.Clear();
            cargarTipoDocumental();

        }
        private void cargarTipoDocumental()
        {
            string IISQL = "select distinct a.SGD_TPR_CODIGO as cod, a.SGD_TPR_DESCRIP as des";
            IISQL += " FROM SGD_TPR_TPDCUMENTO a WHERE a.SGD_TPR_ESTADO=1 order by a.SGD_TPR_CODIGO ASC ";
            OracleConnection con = new OracleConnection(funciones.conni);
            try
            {
                con.Open();
                OracleCommand command = new OracleCommand(IISQL, con);
                using (OracleDataReader reader = command.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        int SGD_TPR_CODIGO = 0;
                        if (int.TryParse(reader[0].ToString(), out SGD_TPR_CODIGO))
                        {
                            if (reader[1]!=null)
                            {
                                cBoxtDocumento.Items.Add(SGD_TPR_CODIGO.ToString() + " " + (string)reader[1]);
                            }
                        }
                    }
                }
                funciones.desconectar(con);
            }
            catch (Exception ex)
            {
                funciones.desconectar(con);
            }
        }
        private void cBoxtRadicado_load()
        {
            cBoxtRadicado.Items.Clear();
            if (funciones.conexion_test(funciones.conni))
            {
                string sql = "SELECT SGD_TRAD_CODIGO, SGD_TRAD_DESCR FROM OW_ORFEO.SGD_TRAD_TIPORAD ORDER BY SGD_TRAD_CODIGO";
                OracleConnection con = new OracleConnection(funciones.conni);
                try
                {
                    con.Open();
                    OracleCommand command = new OracleCommand(sql, con);
                    using (OracleDataReader reader = command.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            int SGD_TRAD_CODIGO = 0;
                            if (int.TryParse(reader[0].ToString(), out SGD_TRAD_CODIGO))
                            {
                                cBoxtRadicado.Items.Add(SGD_TRAD_CODIGO.ToString() + " " + (string)reader[1]);
                            }
                        }
                    }

                    funciones.desconectar(con);
                }
                catch (Exception ex)
                {
                    funciones.desconectar(con);
                }
            }
        }
        private void buscarRadicadoToolStripMenuItem_Click(object sender, EventArgs e)
        {
            InputBoxResult result = InputBox.Show("Digite el registro de radicado a consultar", "Consultar Radicado", string.Empty, 100, 0);
            if (result.ReturnCode == DialogResult.OK)
            {
                if (result.Text.Length > 4)
                {
                    if (!string.IsNullOrEmpty(usuarioScanOrfeo.DEPE_CODI.ToString().Trim()))
                        BuscarRadicado(result.Text);
                    else
                        MessageBox.Show("Debe seleccionar una dependencia a Buscar");
                }
                else
                    MessageBox.Show("El número de radicado debe tener más de 4 caracteres");
            }
        }
        private void buscarEnTodosLosRadicadoOExpedientesToolStripMenuItem_Click(object sender, EventArgs e)
        {
            InputBoxResult result = InputBox.Show("Registro a Buscar", "Buscar Expediente", string.Empty, 100, 0);
            if (result.ReturnCode == DialogResult.OK)
            {
                if (result.Text.Length > 4)
                {
                    if (!string.IsNullOrEmpty(usuarioScanOrfeo.DEPE_CODI.ToString().Trim()))
                        BuscarRadicadoExpediente(result.Text);
                    else
                        MessageBox.Show("Debe seleccionar una dependencia a Buscar");
                }
                else
                    MessageBox.Show("El número de expediente debe tener más de 4 caracteres");
            }
        }
        private void BuscarRadicadoExpediente(string numradicado)
        {
            codbarras_private = null;
            limpiar_informacion_radicado();
            dataGridView1.DataSource = null;
            string IISQL;
            OracleConnection con = new OracleConnection(funciones.conni);
            IISQL = " SELECT 'EXPEDIENTE' as TIPO,S.DEPE_CODI AS DEPENDENCIA, S.SGD_EXP_NUMERO AS NÚMERO_EXPEDIENTE,(SELECT COUNT(*) FROM SGD_AEX_ANEXOEXPEDIENTE A WHERE A.SGD_AEX_EXPEDIENTE = S.SGD_EXP_NUMERO) AS NÚM_ANEXOS ,S.SGD_SEXP_PAREXP1 AS ASUNTO,S.SGD_SEXP_PAREXP3 AS NOMBRE_Y_DOCUMENTO,S.SGD_SEXP_FECH AS FECHA ";
            IISQL = IISQL + " ";
            IISQL = IISQL + " FROM SGD_SEXP_SECEXPEDIENTES S ";
            IISQL = IISQL + " WHERE S.SGD_EXP_NUMERO LIKE '%" + numradicado.Trim() + "%' ";
            IISQL = IISQL + " ORDER BY S.SGD_SEXP_FECH DESC ";
            try
            {
                con.Open();
                show_loading_panel(361, 174, 414, 36);
                OracleCommand command = new OracleCommand(IISQL, con);
                OracleDataAdapter sda = new OracleDataAdapter(command);
                DataTable dt = new DataTable();
                sda.Fill(dt);
                con.Close();
                con.Dispose();
                dataGridView1.DataSource = dt;
                dataGridView1.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
                hide_loading_panel();
            }
            catch (Exception ex)
            {
                hide_loading_panel();
                con.Close();
                con.Dispose();
                MessageBox.Show(ex.ToString());
            }
            System.Windows.Forms.Clipboard.SetText(IISQL);
        }
        private void BuscarRadicado(string numradicado)
        {
            codbarras_private = null;
            limpiar_informacion_radicado();
            dataGridView1.DataSource = null;
            string IISQL;
            OracleConnection con = new OracleConnection(funciones.conni);
            if (impresiónDeSobresToolStripMenuItem.Checked)
                IISQL = "Select 'RADICADO' as TIPO, a.RADI_NUME_RADI AS NUMERO_RADICADO,a.RADI_FECH_RADI AS FECHA,renv.SGD_RENV_NOMBRE AS DESTINO,renv.SGD_RENV_DIR AS DIRECCIÓN,renv.SGD_RENV_DEPTO AS DEPARTAMENTO,renv.SGD_RENV_MPIO AS MUNICIPIO,a.RA_ASUN AS ASUNTO from Radicado a,dependencia b, sgd_renv_regenvio renv where a.RADI_DEPE_ACTU=b.DEPE_CODI AND a.RADI_NUME_RADI=renv.RADI_NUME_SAL AND a.RADI_CHAR_RADI LIKE '" + DateTime.Now.Year.ToString() + usuarioScanOrfeo.DEPE_CODI.ToString().Substring(0, 3) + "%'";
            else
                IISQL = "Select 'RADICADO' as TIPO, a.RADI_NUME_HOJA PAGINAS,a.RADI_NUME_RADI NUMERO_RADICADO,a.RADI_FECH_RADI FECHA,a.RA_ASUN ASUNTO, a.RADI_DEPE_ACTU DEPENDENCIA_ACTUAL,a.RADI_PATH PATH  from Radicado a where a.radi_nume_radi is not null  ";

            IISQL += " and a.radi_char_radi like '%" + numradicado.Trim() + "%' ";
            //IISQL += " and (a.radi_char_radi = '20190000850961' or a.radi_char_radi = '20195260194683')";
            try
            {
                show_loading_panel(361, 174, 414, 36);
                lblTipoEnvio.Text = "";
                btnEnviarPDF1.FlatAppearance.BorderColor = System.Drawing.Color.FromArgb(0, 255, 255, 255);
                btnEnviarPDF1.FlatAppearance.BorderSize = 0;
                con.Open();
                OracleCommand command = new OracleCommand(IISQL, con);
                OracleDataAdapter sda = new OracleDataAdapter(command);
                DataTable dt = new DataTable();
                sda.Fill(dt);
                con.Close();
                con.Dispose();
                dataGridView1.DataSource = dt;
                dataGridView1.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
                hide_loading_panel();
            }
            catch (Exception ex)
            {
                hide_loading_panel();
                con.Close();
                con.Dispose();
                MessageBox.Show(ex.ToString());
            }
            System.Windows.Forms.Clipboard.SetText(IISQL);
        }
        private void anexarImagenAUnRadicadoToolStripMenuItem_Click(object sender, EventArgs e)
        {
            if (!anexarImagenAUnRadicadoToolStripMenuItem.Checked)
            {
                Doc_Anexo = true;
            }
            else
            {
                Doc_Anexo = false;
            }
            Verificar_Envio();
        }
        private void Verificar_Envio()
        {
            if (anexarImagenAUnRadicadoToolStripMenuItem.Checked)
            {
                btn_enviar_1.Visible = false;
                btn_enviar_2.Visible = true;
            }
            else
            {
                btn_enviar_2.Visible = false;
                btn_enviar_1.Visible = true;
            }
        }
        private void buscarSoloEnTipoToolStripMenuItem_Click(object sender, EventArgs e)
        {
            if (!string.IsNullOrEmpty(cBoxtRadicado.Text.Trim()))
            {
                InputBoxResult result = InputBox.Show("Registro a Buscar Tipo de Radicacion " + cBoxtRadicado.Text, "Consultar Radicado por Tipo", string.Empty, 100, 0);
                if (result.ReturnCode == DialogResult.OK)
                {
                    if (result.Text.Length > 4)
                    {
                        if (!string.IsNullOrEmpty(usuarioScanOrfeo.DEPE_CODI.ToString().Trim()))
                            BuscarRadicadoTP(result.Text);
                        else
                            MessageBox.Show("Debe seleccionar una dependencia a Buscar");
                    }
                    else
                        MessageBox.Show("Introduzca mínimo 4 caracteres");
                }
            }
            else
                MessageBox.Show("Debe seleccionar un Tipo antes de iniciar la consulta");
        }
        private void BuscarRadicadoTP(string numradicado)
        {
            codbarras_private = null;
            limpiar_informacion_radicado();
            dataGridView1.DataSource = null;
            string IISQL;
            OracleConnection con = new OracleConnection(funciones.conni);
            if (impresiónDeSobresToolStripMenuItem.Checked)
                IISQL = "Select 'RADICADO' as TIPO, a.RADI_NUME_HOJA PAGINAS, a.RADI_NUME_RADI NUMERO_RADICADO, a.RADI_FECH_RADI FECHA, a.RA_ASUN ASUNTO, a.RADI_DEPE_ACTU DEPENDENCIA_ACTUAL, a.RADI_PATH PATH, a.RADI_NOMB " + varConcat + " a.RADI_PRIM_APEL" + varConcat + " a.RADI_SEGU_APEL AS RADI_NOMB,renv.SGD_RENV_NOMBRE,renv.SGD_RENV_DIR,renv.SGD_RENV_DEPTO,renv.SGD_RENV_MPIO,a.RADI_USUA_ACTU,b.depe_nomb," + varRadi_Fech_radi + " as anomes_rad from Radicado a,dependencia b, sgd_renv_regenvio renv where a.RADI_DEPE_ACTU=b.DEPE_CODI AND a.RADI_NUME_RADI=renv.RADI_NUME_SAL  AND a.RADI_CHAR_RADI LIKE '" + DateTime.Now.Year.ToString() + usuarioScanOrfeo.DEPE_CODI.ToString().Substring(0, 3) + "%'";
            else
                IISQL = "Select a.RADI_NUME_HOJA,a.RADI_NUME_RADI,a.RADI_FECH_RADI,a.RA_ASUN, a.RADI_DEPE_ACTU,a.RADI_PATH,a.RADI_USUA_ACTU from Radicado a where a.radi_nume_radi is not null  ";
            IISQL = IISQL + " and a.radi_char_radi like '%" + numradicado.Trim() + "%' ";

            string tipoRad = cBoxtRadicado.Text.Trim().Substring(0, 1);
            IISQL = IISQL + " and " + varSubstr + "(radi_char_radi,5,3) =  '" + usuarioScanOrfeo.DEPE_CODI.ToString().Substring(0, 3) + "'";
            IISQL = IISQL + " and a.radi_char_radi like '%" + tipoRad + "'";
            try
            {
                show_loading_panel(361, 174, 414, 36);
                lblTipoEnvio.Text = "";
                btnEnviarPDF1.FlatAppearance.BorderColor = System.Drawing.Color.FromArgb(0, 255, 255, 255);
                btnEnviarPDF1.FlatAppearance.BorderSize = 0;
                con.Open();
                OracleCommand command = new OracleCommand(IISQL, con);
                OracleDataAdapter sda = new OracleDataAdapter(command);
                DataTable dt = new DataTable();
                sda.Fill(dt);
                con.Close();
                con.Dispose();
                dataGridView1.DataSource = dt;
                dataGridView1.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
                hide_loading_panel();
            }
            catch (Exception ex)
            {
                hide_loading_panel();
                con.Close();
                con.Dispose();
                MessageBox.Show(ex.ToString());
            }
            System.Windows.Forms.Clipboard.SetText(IISQL);
        }
        private void buscarEnTodosLosRadicadosMasivaToolStripMenuItem_Click(object sender, EventArgs e)
        {
            InputBoxResult result = InputBox.Show("Registro a Buscar Tipo de Radicacion Masiva, Digite el nombre exacto del Grupo de masiva o el PRIMER NUMERO DE RADICADO DEL GRUPO que ha enviado ", "Consultar Radicado por Masiva", string.Empty, 100, 0);
            if (result.ReturnCode == DialogResult.OK)
            {
                if (result.Text.Length > 4)
                {
                    if (!string.IsNullOrEmpty(usuarioScanOrfeo.DEPE_CODI.ToString().Trim()))
                        BuscarRadicadoMasiva(result.Text);
                    else
                        MessageBox.Show("Debe seleccionar una dependencia a Buscar");
                }
                else
                    MessageBox.Show("Introduzca mínimo 4 caracteres");
            }
        }
        private void BuscarRadicadoMasiva(string numradicado)
        {
            codbarras_private = null;
            limpiar_informacion_radicado();
            dataGridView1.DataSource = null;
            string IISQL = string.Empty;
            OracleConnection con = new OracleConnection(funciones.conni);
            if (impresiónDeSobresToolStripMenuItem.Checked)
            {
                IISQL = "Select a.RADI_NUME_HOJA,a.RADI_NUME_RADI,a.RADI_FECH_RADI,a.RA_ASUN, CONCAT(CONCAT(CONCAT(CONCAT(a.RADI_NOMB , ' '), a.RADI_PRIM_APEL),' '), a.RADI_SEGU_APEL) AS RADI_NOMB,a.RADI_DEPE_ACTU,renv.SGD_RENV_NOMBRE,renv.SGD_RENV_DIR,renv.SGD_RENV_DEPTO,renv.SGD_RENV_MPIO,a.RADI_USUA_ACTU,b.depe_nomb," + varRadi_Fech_radi + " as anomes_rad from Radicado a,dependencia b, sgd_renv_regenvio renv where a.RADI_DEPE_ACTU=b.DEPE_CODI AND a.RADI_NUME_RADI=renv.RADI_NUME_SAL  ";
                IISQL = IISQL + " and renv.radi_nume_grupo like '" + numradicado.Trim() + "' ";
            }
            if (!string.IsNullOrEmpty(IISQL))
            {
                try
                {
                    show_loading_panel(361, 174, 414, 36);
                    lblTipoEnvio.Text = "";
                    btnEnviarPDF1.FlatAppearance.BorderColor = System.Drawing.Color.FromArgb(0, 255, 255, 255);
                    btnEnviarPDF1.FlatAppearance.BorderSize = 0;
                    con.Open();
                    OracleCommand command = new OracleCommand(IISQL, con);
                    OracleDataAdapter sda = new OracleDataAdapter(command);
                    DataTable dt = new DataTable();
                    sda.Fill(dt);
                    con.Close();
                    con.Dispose();
                    dataGridView1.DataSource = dt;
                    dataGridView1.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;
                    hide_loading_panel();
                }
                catch (Exception ex)
                {
                    hide_loading_panel();
                    con.Close();
                    con.Dispose();
                    MessageBox.Show(ex.ToString());
                }
                System.Windows.Forms.Clipboard.SetText(IISQL);
            }
        }
        private void guardarImagenToolStripMenuItem_Click(object sender, EventArgs e)
        {
            GuardarImagen();
        }
        private void GuardarImagen()
        {
            if (!string.IsNullOrEmpty(labelImagen.Text.Trim()))
            {
                DEPRADICADO = labelImagen.Text.Substring(5, 3);
                string imagenf = "/" + labelImagen.Text.Substring(0, 4) + "/" + DEPRADICADO + "/" + labelImagen.Text + ".tif";
                string dirserver = "/" + labelImagen.Text.Substring(0, 4) + "/" + DEPRADICADO + "/";
                string ImagenLocal = DirTraB + imagenf;
            }
        }
        private void configuraciónToolStripMenuItem_Click(object sender, EventArgs e)
        {
            configuracion frm = new configuracion();
            frm.Show();
        }
        private void imprimirImagenToolStripMenuItem_Click(object sender, EventArgs e)
        {
            //Show print dialog
            PrintDialog pd = new PrintDialog();
            PrintDocument doc = new PrintDocument();
            doc.PrintPage += Doc_PrintPage;
            pd.Document = doc;
            if (pd.ShowDialog() == DialogResult.OK)
                doc.Print();
        }
        private void Doc_PrintPage(object sender, PrintPageEventArgs e)
        {
            //Print image
            Bitmap bm = new Bitmap(816, 1056);
            PageEdit.DrawToBitmap(bm, new System.Drawing.Rectangle(0, 0, PageEdit.Width, PageEdit.Height));
            e.Graphics.DrawImage(bm, 0, 0);
            bm.Dispose();
        }
        private void preparar_pagina(PictureBox picture)
        {
            //PageEdit.Image = null;
            picture.Image = null;
        }
        private void cargar_pagina(string path, PictureBox picture)
        {
            //picture.Image =;
        }

        private void button16_Click(object sender, EventArgs e)
        {

        }

        private void button15_Click(object sender, EventArgs e)
        {

        }

        private void button14_Click(object sender, EventArgs e)
        {

        }

        private void button13_Click(object sender, EventArgs e)
        {
            var imagen = RotateImage(TiffCarga[0], 90, true, true, System.Drawing.Color.White);
            TiffCarga[0] = imagen;
            PageEdit.Image = imagen;
        }

        private void button12_Click(object sender, EventArgs e)
        {
            var imagen = RotateImage(TiffCarga[0], -90, true, true, System.Drawing.Color.White);
            TiffCarga[0] = imagen;
            PageEdit.Image = imagen;
        }

        private void btn_enviar_2_Click(object sender, EventArgs e)
        {

        }

        private void btn_enviar_1_Click(object sender, EventArgs e)
        {

        }

        private void button17_Click(object sender, EventArgs e)
        {

        }

        private void numericUpDown2_ValueChanged(object sender, EventArgs e)
        {

        }

        private void numericUpDown1_ValueChanged(object sender, EventArgs e)
        {

        }

        private void label3_Click(object sender, EventArgs e)
        {

        }

        
        
        private List<System.Drawing.Image> Split(string pstrInputFilePath)
        {
            List<System.Drawing.Image> cargar = new List<System.Drawing.Image>();
            System.Drawing.Image tiffImage = System.Drawing.Image.FromFile(pstrInputFilePath);
            Guid objGuid = tiffImage.FrameDimensionsList[0];
            FrameDimension dimension = new FrameDimension(objGuid);
            int noOfPages = tiffImage.GetFrameCount(dimension);

            ImageCodecInfo encodeInfo = null;
            ImageCodecInfo[] imageEncoders = ImageCodecInfo.GetImageEncoders();
            for (int j = 0; j < imageEncoders.Length; j++)
            {
                if (imageEncoders[j].MimeType == "image/tiff")
                {
                    encodeInfo = imageEncoders[j];
                    break;
                }
            }

            foreach (Guid guid in tiffImage.FrameDimensionsList)
            {
                for (int index = 0; index < noOfPages; index++)
                {
                    FrameDimension currentFrame = new FrameDimension(guid);
                    tiffImage.SelectActiveFrame(currentFrame, index);
                    Bitmap nextFrame = new Bitmap(tiffImage);
                    cargar.Add(nextFrame);
                }
            }
            return cargar;
        }
        private void cargarImagen(List<System.Drawing.Image> imagenes, int[] range, bool inicial)
        {
            TiffCarga.Clear();
            foreach (var imagen in imagenes)
            {
                Bitmap nextFrame = new Bitmap(imagen);
                TiffCarga.Add(nextFrame);
            }
            paginaActual = 1;

            bool pageEmpty1 = true;
            bool pageEmpty2 = true;
            bool pageEmpty3 = true;

            for (int i = range[0]; i < range[1] + 1; i++)
            {
                bool asigno = false;
                if (pageEmpty1 && !asigno)
                {
                    if (TiffCarga.Count >= i + 1)
                    {
                        PageScreen1.Image = TiffCarga[i];
                        lblScreen1.Text = pref_pag + (i + 1).ToString();
                        pageEmpty1 = false;
                        asigno = true;
                    }
                }
                if (pageEmpty2 && !asigno)
                {
                    if (TiffCarga.Count >= i + 1)
                    {
                        PageScreen2.Image = TiffCarga[i];
                        lblScreen2.Text = pref_pag + (i + 1).ToString();
                        pageEmpty2 = false;
                        asigno = true;
                    }
                }
                if (pageEmpty3 && !asigno)
                {
                    if (TiffCarga.Count >= i + 1)
                    {
                        PageScreen3.Image = TiffCarga[i];
                        lblScreen3.Text = pref_pag + (i + 1).ToString();
                        pageEmpty3 = false;
                        asigno = true;
                    }
                }
            }
            if (pageEmpty1)
            {
                PageScreen1.Image = null;
                lblScreen1.Text = "";
            }

            if (pageEmpty2)
            {
                PageScreen2.Image = null;
                lblScreen2.Text = "";
            }

            if (pageEmpty3)
            {
                PageScreen3.Image = null;
                lblScreen3.Text = "";
            }

            if (inicial && TiffCarga.Count >= 1)
                PageEdit.Image = TiffCarga[0];
        }
        private void cargarImagen1(int[] range)
        {

            bool pageEmpty1 = true;
            bool pageEmpty2 = true;
            bool pageEmpty3 = true;

            for (int i = range[0]; i < range[1] + 1; i++)
            {
                bool asigno = false;
                if (pageEmpty1 && !asigno)
                {
                    if (TiffCarga.Count >= i + 1)
                    {
                        PageScreen1.Image = TiffCarga[i];
                        lblScreen1.Text = pref_pag + (i + 1).ToString();
                        pageEmpty1 = false;
                        asigno = true;
                    }
                }
                if (pageEmpty2 && !asigno)
                {
                    if (TiffCarga.Count >= i + 1)
                    {
                        PageScreen2.Image = TiffCarga[i];
                        lblScreen2.Text = pref_pag + (i + 1).ToString();
                        pageEmpty2 = false;
                        asigno = true;
                    }
                }
                if (pageEmpty3 && !asigno)
                {
                    if (TiffCarga.Count >= i + 1)
                    {
                        PageScreen3.Image = TiffCarga[i];
                        lblScreen3.Text = pref_pag + (i + 1).ToString();
                        pageEmpty3 = false;
                        asigno = true;
                    }
                }
            }
            if (pageEmpty1)
            {
                PageScreen1.Image = null;
                lblScreen1.Text = "";
            }

            if (pageEmpty2)
            {
                PageScreen2.Image = null;
                lblScreen2.Text = "";
            }

            if (pageEmpty3)
            {
                PageScreen3.Image = null;
                lblScreen3.Text = "";
            }
        }
        
        private void cargarImagen2(int[] range, string path)
        {

            bool pageEmpty1 = true;
            bool pageEmpty2 = true;
            bool pageEmpty3 = true;

            for (int i = range[0]; i < range[1] + 1; i++)
            {
                bool asigno = false;
                if (pageEmpty1 && !asigno)
                {
                    if (TiffCarga.Count >= i + 1)
                    {
                        PageScreen1.Image = TiffCarga[i];
                        lblScreen1.Text = pref_pag + (i + 1).ToString();
                        pageEmpty1 = false;
                        asigno = true;
                    }
                }
                if (pageEmpty2 && !asigno)
                {
                    if (TiffCarga.Count >= i + 1)
                    {
                        PageScreen2.Image = TiffCarga[i];
                        lblScreen2.Text = pref_pag + (i + 1).ToString();
                        pageEmpty2 = false;
                        asigno = true;
                    }
                }
                if (pageEmpty3 && !asigno)
                {
                    if (TiffCarga.Count >= i + 1)
                    {
                        PageScreen3.Image = TiffCarga[i];
                        lblScreen3.Text = pref_pag + (i + 1).ToString();
                        pageEmpty3 = false;
                        asigno = true;
                    }
                }
            }
            if (pageEmpty1)
            {
                PageScreen1.Image = null;
                lblScreen1.Text = "";
            }

            if (pageEmpty2)
            {
                PageScreen2.Image = null;
                lblScreen2.Text = "";
            }

            if (pageEmpty3)
            {
                PageScreen3.Image = null;
                lblScreen3.Text = "";
            }
        }
        private void button7_Click(object sender, EventArgs e)
        {
            try
            {
                using (var client = new WebClient())
                {
                    client.Credentials = new NetworkCredential(digitalizador_user, digitalizador);
                    client.UploadFile("ftp://fs04cc01/bodega_dev_of01/hello_A1_b_cs.pdf", WebRequestMethods.Ftp.UploadFile, @"D:\hello_A1_b_cs.pdf");
                    MessageBox.Show("El archivo se subió correctamente");
                }
                var request = (FtpWebRequest)WebRequest.Create("ftp://fs04cc01/bodega_dev_of01/hello_A1_b_cs.pdf");
                request.Credentials = new NetworkCredential(digitalizador_user, digitalizador);
                request.Method = WebRequestMethods.Ftp.GetFileSize;

                try
                {
                    FtpWebResponse response = (FtpWebResponse)request.GetResponse();
                    MessageBox.Show("El archivo se subió correctamente");
                }
                catch (WebException ex)
                {
                    FtpWebResponse response = (FtpWebResponse)ex.Response;
                    if (response.StatusCode ==
                        FtpStatusCode.ActionNotTakenFileUnavailable)
                    {
                        MessageBox.Show("El archivo no se subió correctamente, por favor vuelva a intentar");
                    }
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.ToString());
            }
        }
        private void button6_Click(object sender, EventArgs e)
        {

        }



        private void label4_Click(object sender, EventArgs e)
        {

        }
        private void button4_Click(object sender, EventArgs e)
        {

        }
        private void show_loading_panel(int size_x, int size_y, int loc_x, int loc_y)
        {
            pan_loading.Location = new Point(loc_x, loc_y);
            pan_loading.Size = new Size(size_x, size_y);
            pan_loading.Visible = true;
            pan_loading.Enabled = true;
            pan_loading.Refresh();
        }
        private void hide_loading_panel()
        {
            pan_loading.Location = new Point(0, 0);
            pan_loading.Size = new Size(1, 1);
            pan_loading.Visible = false;
            pan_loading.Enabled = false;
            pan_loading.Refresh();
        }





        //Metodos y funciones para Escaner
        protected override void OnHandleCreated(EventArgs e)
        {
            base.OnHandleCreated(e);
            SetupTwain();
        }
        private void SetupTwain()
        {
            var appId = TWIdentity.CreateFromAssembly(DataGroups.Image, Assembly.GetEntryAssembly());
            _twain = new TwainSession(appId);
            _twain.StateChanged += (s, e) =>
            {
                PlatformInfo.Current.Log.Info("State changed to " + _twain.State + " on thread " + Thread.CurrentThread.ManagedThreadId);
            };
            _twain.TransferError += (s, e) =>
            {
                PlatformInfo.Current.Log.Info("Got xfer error on thread " + Thread.CurrentThread.ManagedThreadId);
            };
            _twain.DataTransferred += (s, e) =>
            {
                PlatformInfo.Current.Log.Info("Transferred data event on thread " + Thread.CurrentThread.ManagedThreadId);

                // example on getting ext image info
                var infos = e.GetExtImageInfo(ExtendedImageInfo.Camera).Where(it => it.ReturnCode == ReturnCode.Success);
                foreach (var it in infos)
                {
                    var values = it.ReadValues();
                    PlatformInfo.Current.Log.Info(string.Format("{0} = {1}", it.InfoID, values.FirstOrDefault()));
                    break;
                }

                // handle image data
                System.Drawing.Image img = null;
                if (e.NativeData != IntPtr.Zero)
                {
                    var stream = e.GetNativeImageStream();
                    if (stream != null)
                    {
                        img = System.Drawing.Image.FromStream(stream);
                    }
                }
                else if (!string.IsNullOrEmpty(e.FileDataPath))
                {
                    img = new Bitmap(e.FileDataPath);
                }
                if (img != null)
                {
                    this.BeginInvoke(new Action(() =>
                    {
                        if (PageEdit.Image != null)
                        {
                            PageEdit.Image.Dispose();
                            PageEdit.Image = null;
                        }
                        PageEdit.Image = img;
                        var stream = new System.IO.MemoryStream();
                        img.Save(stream, System.Drawing.Imaging.ImageFormat.Tiff);
                        stream.Position = 0;
                        var image = System.Drawing.Image.FromStream(stream);
                        imagenes.Add(image);
                        pageRange[0] = 0;
                        pageRange[1] = 2;
                        cargarImagen(imagenes, pageRange, true);
                    }));
                }
            };
            _twain.SourceDisabled += (s, e) =>
            {
                PlatformInfo.Current.Log.Info("Source disabled event on thread " + Thread.CurrentThread.ManagedThreadId);
                this.BeginInvoke(new Action(() =>
                {
                    btnStopScan.Enabled = false;
                    btnStopScan.Visible = false;
                    btnStartCapture.Enabled = true;
                    btnStartCapture.Visible = true;
                    //panelOptions.Enabled = true;
                    LoadSourceCaps();
                    //clean_picturebox();
                    //cargar_picturebox();
                }));
            };
            _twain.TransferReady += (s, e) =>
            {
                PlatformInfo.Current.Log.Info("Transferr ready event on thread " + Thread.CurrentThread.ManagedThreadId);
                e.CancelAll = _stopScan;
            };

            // either set sync context and don't worry about threads during events,
            // or don't and use control.invoke during the events yourself
            PlatformInfo.Current.Log.Info("Setup thread = " + Thread.CurrentThread.ManagedThreadId);
            _twain.SynchronizationContext = SynchronizationContext.Current;
            if (_twain.State < 3)
            {
                // use this for internal msg loop
                _twain.Open();
                // use this to hook into current app loop
                //_twain.Open(new WindowsFormsMessageLoopHook(this.Handle));
            }
        }
        void SourceMenuItem_Click(object sender, EventArgs e)
        {
            // do nothing if source is enabled
            if (_twain.State > 4) { return; }

            if (_twain.State == 4) { _twain.CurrentSource.Close(); }

            foreach (var btn in seleccionarEscanerToolStripMenuItem.DropDownItems)
            {
                var srcBtn = btn as ToolStripMenuItem;
                if (srcBtn != null) { srcBtn.Checked = false; }
            }

            var curBtn = (sender as ToolStripMenuItem);
            var src = curBtn.Tag as DataSource;
            if (src.Open() == ReturnCode.Success)
            {
                curBtn.Checked = true;
                btnStartCapture.Enabled = true;
                LoadSourceCaps();
            }
        }
        protected override void OnFormClosing(FormClosingEventArgs e)
        {
            if (_twain != null)
            {
                if (e.CloseReason == CloseReason.UserClosing && _twain.State > 4)
                {
                    e.Cancel = true;
                }
                else
                {
                    CleanupTwain();
                }
            }
            base.OnFormClosing(e);
        }
        private void CleanupTwain()
        {
            if (_twain.State == 4)
            {
                _twain.CurrentSource.Close();
            }
            if (_twain.State == 3)
            {
                _twain.Close();
            }

            if (_twain.State > 2)
            {
                // normal close down didn't work, do hard kill
                _twain.ForceStepDown(2);
            }
        }

        private void configurarEscanerToolStripMenuItem_Click(object sender, EventArgs e)
        {
            try
            {
                _twain.CurrentSource.Enable(SourceEnableMode.ShowUIOnly, true, this.Handle);
            }
            catch (Exception)
            {
                MessageBox.Show("Asegurese que exista un escaner conectado y encendido para iniciar la configuración");
            }
            
        }
        private void btnStartCapture_Click(object sender, EventArgs e)
        {
            imagenes.Clear();
            PageEdit.Image = null;
            if (_twain.State == 4)
            {
                //_twain.CurrentSource.CapXferCount.Set(4);

                _stopScan = false;

                if (_twain.CurrentSource.Capabilities.CapUIControllable.IsSupported)//.SupportedCaps.Contains(CapabilityId.CapUIControllable))
                {
                    // hide scanner ui if possible
                    if (_twain.CurrentSource.Enable(SourceEnableMode.NoUI, false, this.Handle) == ReturnCode.Success)
                    {
                        btnStopScan.Enabled = true;
                        btnStopScan.Visible = true;
                        btnStartCapture.Enabled = false;
                        btnStartCapture.Visible = false;
                    }
                }
                else
                {
                    if (_twain.CurrentSource.Enable(SourceEnableMode.ShowUI, true, this.Handle) == ReturnCode.Success)
                    {
                        btnStopScan.Enabled = true;
                        btnStopScan.Visible = true;
                        btnStartCapture.Enabled = false;
                        btnStartCapture.Visible = false;
                    }
                }
            }
        }

        private void btnStopScan_Click(object sender, EventArgs e)
        {
            _stopScan = true;
        }
        private void LoadSourceCaps()
        {
            var src = _twain.CurrentSource;
            _loadingCaps = true;

            //var test = src.SupportedCaps;

            if (groupDepth.Enabled = src.Capabilities.ICapPixelType.IsSupported)
            {
                LoadDepth(src.Capabilities.ICapPixelType);
            }
            if (groupDuplex.Enabled = src.Capabilities.ICapAutomaticRotate.IsSupported)
            {
                LoadAutoRotation(src.Capabilities.ICapAutomaticRotate);
            }
            if (groupDPI.Enabled = src.Capabilities.ICapXResolution.IsSupported && src.Capabilities.ICapYResolution.IsSupported)
            {
                LoadDPI(src.Capabilities.ICapXResolution);
            }
            // TODO: find out if this is how duplex works or also needs the other option
            if (groupDuplex.Enabled = src.Capabilities.CapDuplexEnabled.IsSupported)
            {
                LoadDuplex(src.Capabilities.CapDuplexEnabled);
            }
            if (groupSize.Enabled = src.Capabilities.ICapSupportedSizes.IsSupported)
            {
                LoadPaperSize(src.Capabilities.ICapSupportedSizes);
            }
            configurarEscanerToolStripMenuItem.Enabled = src.Capabilities.CapEnableDSUIOnly.IsSupported;
            _loadingCaps = false;
        }
        //Capacidad e tamaño de papel
        private void LoadPaperSize(ICapWrapper<SupportedSize> cap)
        {
            var list = cap.GetValues().ToList();
            comboSize.DataSource = list;
            var cur = cap.GetCurrent();
            if (list.Contains(cur))
            {
                comboSize.SelectedItem = cur;
            }
            var labelTest = cap.GetLabel();
            if (!string.IsNullOrEmpty(labelTest))
            {
                groupSize.Text = labelTest;
            }
        }
        //capacidad de dos caras
        private void LoadDuplex(ICapWrapper<BoolType> cap)
        {
            ckDuplex.Checked = cap.GetCurrent() == BoolType.True;
        }
        private void LoadAutoRotation(ICapWrapper<BoolType> cap)
        {
            ckDuplex.Checked = cap.GetCurrent() == BoolType.False;
        }
        //capacidad de numero de DPI
        private void LoadDPI(ICapWrapper<TWFix32> cap)
        {
            // only allow dpi of certain values for those source that lists everything
            var list = cap.GetValues().Where(dpi => (dpi % 50) == 0).ToList();
            comboDPI.DataSource = list;
            var cur = cap.GetCurrent();
            if (list.Contains(cur))
            {
                comboDPI.SelectedItem = cur;
            }
        }
        //Capacidad Calidad de Color
        private void LoadDepth(ICapWrapper<PixelType> cap)
        {
            var list = cap.GetValues().ToList();
            comboDepth.DataSource = list;
            var cur = cap.GetCurrent();
            if (list.Contains(cur))
            {
                comboDepth.SelectedItem = cur;
            }
            var labelTest = cap.GetLabel();
            if (!string.IsNullOrEmpty(labelTest))
            {
                groupDepth.Text = labelTest;
            }
        }

        private void comboSize_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (!_loadingCaps && _twain.State == 4)
            {
                var sel = (SupportedSize)comboSize.SelectedItem;
                _twain.CurrentSource.Capabilities.ICapSupportedSizes.SetValue(sel);
            }
        }
        private void comboDepth_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (!_loadingCaps && _twain.State == 4)
            {
                var sel = (PixelType)comboDepth.SelectedItem;
                _twain.CurrentSource.Capabilities.ICapPixelType.SetValue(sel);
            }
        }
        private void comboDPI_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (!_loadingCaps && _twain.State == 4)
            {
                var sel = (TWFix32)comboDPI.SelectedItem;
                _twain.CurrentSource.Capabilities.ICapXResolution.SetValue(sel);
                _twain.CurrentSource.Capabilities.ICapYResolution.SetValue(sel);
            }
        }
        private void ckDuplex_CheckedChanged(object sender, EventArgs e)
        {
            if (!_loadingCaps && _twain.State == 4)
            {
                _twain.CurrentSource.Capabilities.CapDuplexEnabled.SetValue(ckDuplex.Checked ? BoolType.True : BoolType.False);
                _twain.CurrentSource.Capabilities.ICapAutomaticRotate.SetValue(BoolType.False);
            }
        }
        private void button5_Click(object sender, EventArgs e)
        {

        }

        private Point RectStartPoint;
        private System.Drawing.Rectangle Rect = new System.Drawing.Rectangle();
        private Brush selectionBrush = new SolidBrush(System.Drawing.Color.FromArgb(128, 72, 145, 220));
        private Brush selectionBrush1 = new SolidBrush(System.Drawing.Color.FromArgb(1, 130, 48, 211));
        private Point _StartPoint;
        //imagen
        private void button9_Click(object sender, EventArgs e)
        {
            if (PageEdit.Image != null && Rect.X > 0 && Rect.Y > 0)
            {
                using (Bitmap bitmap = new Bitmap(Width, Height))
                using (Graphics graphics = Graphics.FromImage(TiffCarga[0]))
                {
                    System.Drawing.Rectangle rect = new System.Drawing.Rectangle(0, 0, Width, Height);
                    graphics.FillRectangle(new SolidBrush(System.Drawing.Color.White), Rect);
                    Invalidate();
                    PageEdit.Refresh();
                }
            }
        }
        private void PageEdit_MouseMove(object sender, MouseEventArgs e)
        {
            if (e.Button != MouseButtons.Left)
                return;
            Point tempEndPoint = e.Location;
            textBox1.Text = tempEndPoint.X.ToString();
            textBox2.Text = tempEndPoint.Y.ToString();

            _StartPoint = e.Location;
            textBox5.Text = _StartPoint.X.ToString();
            textBox4.Text = _StartPoint.Y.ToString();
            textBox5.Text = panel2.AutoScrollPosition.X.ToString();
            textBox4.Text = panel2.AutoScrollPosition.Y.ToString();


            if (PageEdit.Image != null)
            {
                if (tempEndPoint.X <= PageEdit.Image.Width && tempEndPoint.Y <= PageEdit.Image.Height)
                {
                    Rect.Location = new Point(
                        Math.Min(RectStartPoint.X, tempEndPoint.X),
                        Math.Min(RectStartPoint.Y, tempEndPoint.Y));
                    Rect.Size = new Size(
                        Math.Abs(RectStartPoint.X - tempEndPoint.X),
                        Math.Abs(RectStartPoint.Y - tempEndPoint.Y));

                    Point changePoint = new Point(e.Location.X - RectStartPoint.X,
                                  e.Location.Y - RectStartPoint.Y);
                    bool cambio = false;

                    //if (_StartPoint.Y >= 1320 && !cambio)
                    //{
                    //    panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 810);
                    //    cambio = true;
                    //}
                    if (_StartPoint.Y >= 1400 && !cambio)
                    {
                        panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 720);
                        cambio = true;
                    }
                    //if (_StartPoint.Y >= 1320 && !cambio)
                    //{
                    //    panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 810);
                    //    cambio = true;
                    //}
                    if (_StartPoint.Y >= 1200 && !cambio)
                    {
                        panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 600);
                        cambio = true;
                    }
                    //if (_StartPoint.Y >= 1080 && !cambio)
                    //{
                    //    panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 690);
                    //    cambio = true;
                    //}
                    if (_StartPoint.Y >= 960 && !cambio)
                    {
                        panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 480);
                        cambio = true;
                    }

                    //if (_StartPoint.Y >= 840 && !cambio)
                    //{
                    //    panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 330);
                    //    cambio = true;
                    //}
                    if (_StartPoint.Y >= 720 && !cambio)
                    {
                        panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 240);
                        cambio = true;
                    }
                    //if (_StartPoint.Y >= 600 && !cambio)
                    //{
                    //    panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 210);
                    //    cambio = true;
                    //}
                    if (_StartPoint.Y > 480 && !cambio)
                    {
                        panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 120);
                        cambio = true;
                    }
                    if (_StartPoint.Y > 360 && !cambio)
                    {
                        panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 0);
                        cambio = true;
                    }
                    //if (_StartPoint.Y >= 360 && !cambio)
                    //{
                    //    panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 360);
                    //    cambio = true;
                    //}




                    //if (_StartPoint.Y <= 1200 && _StartPoint.Y > 960 && !cambio)
                    //{
                    //    panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, 1440);
                    //    cambio = true;
                    //}

                    //if (_StartPoint.Y > 600)
                    //{
                    //    panel2.AutoScrollPosition = new Point(-panel2.AutoScrollPosition.X, -600);
                    //}




                    //New Drawing.Point((DeltaX - Panel1.AutoScrollPosition.X), (DeltaY - Panel1.AutoScrollPosition.Y));
                }
            }
            PageEdit.Invalidate();
        }
        private void PageEdit_MouseDown(object sender, MouseEventArgs e)
        {
            // Determine the initial rectangle coordinates...
            RectStartPoint = e.Location;

            Invalidate();
        }
        private void PageEdit_Paint(object sender, PaintEventArgs e)
        {
            // Draw the rectangle...
            if (PageEdit.Image != null)
            {
                if (Rect != null && Rect.Width > 0 && Rect.Height > 0)
                {
                    if (Rect.Width <= PageEdit.Image.Width)
                    {
                        Pen blackPen = new Pen(System.Drawing.Color.Black, 1);
                        e.Graphics.DrawRectangle(blackPen, Rect);
                        e.Graphics.FillRectangle(selectionBrush, Rect);
                    }
                    else
                    {

                    }
                }
            }
        }
        private void PageEdit_MouseUp(object sender, MouseEventArgs e)
        {
            if (e.Button == MouseButtons.Left)
            {
                if (Rect.Contains(e.Location))
                {
                    Debug.WriteLine("Right click");
                }
            }
        }
        private void panel2_MouseMove(object sender, MouseEventArgs e)
        {

            //if (e.Button == MouseButtons.Left)
            //{
            //    Point changePoint = new Point(e.Location.X - _StartPoint.X,
            //                                  e.Location.Y - _StartPoint.Y);
            //    panel1.AutoScrollPosition = new Point(-panel1.AutoScrollPosition.X - changePoint.X,
            //                                          -panel1.AutoScrollPosition.Y - changePoint.Y);
            //}
        }
        private void panel2_MouseDown(object sender, MouseEventArgs e)
        {
            //if (e.Button == MouseButtons.Left)
            //    _StartPoint = e.Location;
        }
        private void button10_Click(object sender, EventArgs e)
        {
            var rectangulo = Rect;
            var imagen = PageEdit.Image;
        }
        private System.Drawing.Image generarCodigoBarras(string numero_documento)
        {
            Barcode39 b = new Barcode39();
            System.Drawing.Image img;
            b.ShowString = true;
            b.IncludeCheckSumDigit = true;
            b.TextFont = new System.Drawing.Font("Courier New", 10);
            img = b.GenerateBarcodeImage(codbarras.Width, codbarras.Height, numero_documento);
            return img;
        }
        private System.Drawing.Image generarCodigoBarras_sinver(string numero_documento)
        {
            Barcode39 b = new Barcode39();
            System.Drawing.Image img;
            b.ShowString = false;
            b.IncludeCheckSumDigit = false;
            b.TextFont = new System.Drawing.Font("Courier New", 10);
            img = b.GenerateBarcodeImage(codbarras.Width, codbarras.Height, numero_documento);
            return img;
        }
        private void dataGridView1_CellEnter(object sender, DataGridViewCellEventArgs e)
        {
            lblTipoEnvio.Text = "";
            codbarras_private = null;
            limpiar_informacion_radicado();
            if (dataGridView1.Rows.Count > 0)
            {
                string tipo_rem = "";
                string tipo = "";
                string numero_documento = "";
                string paginas = "";
                string fecha = "";
                string asunto = "";
                string dependencia = "";
                string path = "";
                string nombre_documento = "";
                int OEM = 0;
                int ESP = 0;
                int CIU = 0;
                string FUN = "";
                string remitente = "";

                if (dataGridView1.Rows[e.RowIndex].Cells[0].Value != null)
                    tipo = dataGridView1.Rows[e.RowIndex].Cells[0].Value.ToString();
                if (dataGridView1.Rows[e.RowIndex].Cells[2].Value != null)
                    numero_documento = dataGridView1.Rows[e.RowIndex].Cells[2].Value.ToString();

                if (!string.IsNullOrEmpty(tipo) && !string.IsNullOrEmpty(numero_documento))
                {
                    string IISQL = "Select a.SGD_CIU_CODIGO,a.SGD_ESP_CODI,a.SGD_OEM_CODIGO,a.SGD_DOC_FUN from sgd_dir_drecciones a where a.radi_nume_radi=" + numero_documento;
                    IISQL = IISQL + " ORDER BY SGD_DIR_TIPO  ";
                    OracleConnection con = new OracleConnection(funciones.conni);
                    try
                    {
                        con.Open();
                        OracleCommand command = new OracleCommand(IISQL, con);
                        using (OracleDataReader reader = command.ExecuteReader())
                        {
                            if (reader.Read())
                            {
                                if (int.TryParse(reader[0].ToString(), out CIU))
                                    FUN = "";
                                if (int.TryParse(reader[1].ToString(), out ESP))
                                    FUN = "";
                                if (int.TryParse(reader[2].ToString(), out OEM))
                                    FUN = "";
                                if (reader[3] != null)
                                {
                                    FUN = reader[3].ToString();
                                }
                                funciones.desconectar(con);
                            }
                            else
                                funciones.desconectar(con);
                        }                       
                    }
                    catch (Exception)
                    {
                        funciones.desconectar(con);
                    }

                    if (tipo == "RADICADO")
                    {
                        if (anexarImagenAUnRadicadoToolStripMenuItem.Checked)
                        {
                            btnEnviarPDF1.FlatAppearance.BorderColor = System.Drawing.Color.Red;
                            btnEnviarPDF1.FlatAppearance.BorderSize = 2;
                            lblTipoEnvio.Text = "Anexo de Radicado";
                        }
                        else
                        {
                            btnEnviarPDF1.FlatAppearance.BorderColor = System.Drawing.Color.Blue;
                            btnEnviarPDF1.FlatAppearance.BorderSize = 2;
                            lblTipoEnvio.Text = "Documento Principal de Radicado";
                        }
                        if (dataGridView1.Rows[e.RowIndex].Cells[1].Value != null)
                            paginas = dataGridView1.Rows[e.RowIndex].Cells[1].Value.ToString();
                        if (dataGridView1.Rows[e.RowIndex].Cells[3].Value != null)
                            fecha = dataGridView1.Rows[e.RowIndex].Cells[3].Value.ToString();
                        if (dataGridView1.Rows[e.RowIndex].Cells[4].Value != null)
                            asunto = dataGridView1.Rows[e.RowIndex].Cells[4].Value.ToString();
                        if (dataGridView1.Rows[e.RowIndex].Cells[5].Value != null)
                            dependencia = dataGridView1.Rows[e.RowIndex].Cells[5].Value.ToString();
                        if (dataGridView1.Rows[e.RowIndex].Cells[6].Value != null)
                            path = dataGridView1.Rows[e.RowIndex].Cells[6].Value.ToString();

                        lbl_InfoRadicado1.Text = tipo + " No." + numero_documento.Substring(0, 4) + "-" + numero_documento.Substring(4, 3) + "-" + numero_documento.Substring(7, 6) + "-" + numero_documento.Substring(13, 1);
                        lbl_InfoRadicado2.Text = "Fecha" + fecha + "->" + dependencia;

                        if (OEM > 0)
                        {
                            IISQL = "Select a.sgd_oem_oempresa REMITENTE from SGD_OEM_OEMPRESAS a where a.SGD_OEM_CODIGO=" + OEM.ToString();
                            tipo_rem += "(OEM) ";
                        }
                        if (CIU > 0)
                        {
                            IISQL = "Select a.sgd_ciu_nombre || a.sgd_ciu_apell1 || sgd_ciu_apell2 REMITENTE from SGD_CIU_CIUDADANO a where a.sgd_ciu_codigo=" + CIU.ToString();
                            tipo_rem += "(CIU) ";
                        }
                        if (ESP > 0)
                        {
                            IISQL = "Select a.SIGLA_DE_LA_EMPRESA || '-' || a.NOMBRE_DE_LA_EMPRESA REMITENTE from BODEGA_EMPRESAS a where a.IDENTIFICADOR_EMPRESA=" + ESP.ToString();
                            tipo_rem += "(ESP) ";
                        }
                        if (FUN != string.Empty)
                        {
                            IISQL = "Select substr(USUA_NOMB,0,20) || '-' || DEPE_CODI REMITENTE from USUARIO a where a.usua_doc='" + FUN + "'";
                            tipo_rem += "(FUN) ";
                        }

                        con = new OracleConnection(funciones.conni);
                        try
                        {
                            con.Open();
                            OracleCommand command = new OracleCommand(IISQL, con);
                            using (OracleDataReader reader = command.ExecuteReader())
                            {
                                if (reader.Read())
                                {
                                    if (reader[0] != null)
                                        remitente = reader[0].ToString();
                                    funciones.desconectar(con);
                                }
                                else
                                    funciones.desconectar(con);
                            }
                           
                        }
                        catch (Exception ex)
                        {
                            funciones.desconectar(con);
                        }

                        lbl_InfoRadicado3.Text += tipo_rem;
                        lbl_InfoRadicado3.Text += remitente;

                        if (numero_documento.Length == 14)
                            codbarras.Image = generarCodigoBarras(numero_documento);

                        lbl_num_doc.Text = "RADICADO " + numero_documento.Substring(0, 4) + "-" + numero_documento.Substring(4, 3) + "-" + numero_documento.Substring(7, 6) + "-" + numero_documento.Substring(numero_documento.Length - 1);

                        if (path.Contains("pdf") || path.Contains("tif") || path.Contains("tiff"))
                            MessageBox.Show("El radicado seleccionado ya tiene un archivo asociado. Si continua, el pdf será remplazado.");
                    }
                    else if (tipo == "EXPEDIENTE")
                    {
                        btnEnviarPDF1.FlatAppearance.BorderColor = System.Drawing.Color.Black;
                        btnEnviarPDF1.FlatAppearance.BorderSize = 2;
                        lblTipoEnvio.Text = "Anexo de Expediente";
                        if (dataGridView1.Rows[e.RowIndex].Cells[4].Value != null)
                            asunto = dataGridView1.Rows[e.RowIndex].Cells[4].Value.ToString();
                        if (dataGridView1.Rows[e.RowIndex].Cells[5].Value != null)
                            nombre_documento = dataGridView1.Rows[e.RowIndex].Cells[5].Value.ToString();

                        lbl_InfoRadicado1.Text = tipo + " No." + numero_documento;
                        lbl_InfoRadicado2.Text = "Título:";
                        lbl_InfoRadicado3.Text = asunto;
                        lbl_InfoRadicado4.Text = "Nombre-CC-Nit:";
                        lbl_InfoRadicado5.Text = nombre_documento;
                        lbl_num_doc.Text = "EXPEDIENTE " + numero_documento;

                        if (numero_documento.Length > 14)
                            codbarras.Image = generarCodigoBarras(numero_documento);
                    }
                }
            }
        }
        private void buscarTodosRadicadosToolStripMenuItem_Click(object sender, EventArgs e)
        {

        }
        private void limpiar_informacion_radicado()
        {
            lbl_InfoRadicado1.Text = "";
            lbl_InfoRadicado2.Text = "";
            lbl_InfoRadicado3.Text = "";
            lbl_InfoRadicado4.Text = "";
            lbl_InfoRadicado5.Text = "";
            lbl_num_doc.Text = "";
            codbarras.Image = null;
        }
        private void button3_Click(object sender, EventArgs e)
        {
            if (pageRange[1] < TiffCarga.Count)
            {
                pageRange[0]++;
                pageRange[1]++;
                cargarImagen1(pageRange);
            }
        }
        private void button1_Click(object sender, EventArgs e)
        {

            if (pageRange[0] != 0)
            {
                pageRange[0]--;
                pageRange[1]--;
                cargarImagen1(pageRange);
            }
        }
        public static Bitmap RotateImage(System.Drawing.Image inputImage, float angleDegrees, bool upsizeOk,
                                         bool clipOk, System.Drawing.Color backgroundColor)
        {
            if (angleDegrees == 0f)
                return (Bitmap)inputImage.Clone();

            int oldWidth = inputImage.Width;
            int oldHeight = inputImage.Height;
            int newWidth = oldWidth;
            int newHeight = oldHeight;
            float scaleFactor = 1f;

            if (upsizeOk || !clipOk)
            {
                double angleRadians = angleDegrees * Math.PI / 180d;

                double cos = Math.Abs(Math.Cos(angleRadians));
                double sin = Math.Abs(Math.Sin(angleRadians));
                newWidth = (int)Math.Round(oldWidth * cos + oldHeight * sin);
                newHeight = (int)Math.Round(oldWidth * sin + oldHeight * cos);
            }

            if (!upsizeOk && !clipOk)
            {
                scaleFactor = Math.Min((float)oldWidth / newWidth, (float)oldHeight / newHeight);
                newWidth = oldWidth;
                newHeight = oldHeight;
            }

            Bitmap newBitmap = new Bitmap(newWidth, newHeight, backgroundColor == System.Drawing.Color.Transparent ?
                                             PixelFormat.Format32bppArgb : PixelFormat.Format24bppRgb);
            newBitmap.SetResolution(inputImage.HorizontalResolution, inputImage.VerticalResolution);


            using (Graphics graphicsObject = Graphics.FromImage(newBitmap))
            {
                graphicsObject.InterpolationMode = InterpolationMode.HighQualityBicubic;
                graphicsObject.PixelOffsetMode = PixelOffsetMode.HighQuality;
                graphicsObject.SmoothingMode = SmoothingMode.HighQuality;

                if (backgroundColor != System.Drawing.Color.Transparent)
                    graphicsObject.Clear(backgroundColor);

                graphicsObject.TranslateTransform(newWidth / 2f, newHeight / 2f);

                if (scaleFactor != 1f)
                    graphicsObject.ScaleTransform(scaleFactor, scaleFactor);

                graphicsObject.RotateTransform(angleDegrees);
                graphicsObject.TranslateTransform(-oldWidth / 2f, -oldHeight / 2f);

                graphicsObject.DrawImage(inputImage, 0, 0);
            }

            return newBitmap;
        }

        private void btnAbrirImagen_Click(object sender, EventArgs e)
        {
            OpenFileDialog dialog = new OpenFileDialog();
            dialog.Filter = "Archivos de Imagen (*.tif, *.tiff) | *.tif; *.tiff";
            if (Directory.Exists(@"D:\imgidu\"))
            {
                dialog.InitialDirectory = @"D:\imgidu\";
            }
            else
            {
                if (Directory.Exists(@"D:\"))
                {
                    dialog.InitialDirectory = @"D:\";
                }
                else
                {
                    if (Directory.Exists(@"C:\"))
                    {
                        dialog.InitialDirectory = @"C:\";
                    }
                }
            }

            dialog.Title = "Abrir Imagen";

            if (dialog.ShowDialog() == DialogResult.OK)
            {
                string fileName = dialog.FileName;
                var img = Bitmap.FromFile(fileName);
                var pages = img.GetFrameCount(FrameDimension.Page);
                List<System.Drawing.Image> cargar = new List<System.Drawing.Image>();
                cargar = Split(fileName);
                if (cargar.Count > 0)
                    cargarImagen(cargar, pageRange, true);
            }
        }

        private void btnEnviarPDF1_Click(object sender, EventArgs e)
        {
            //tiene que tener una fila seleccionada
            var rutaS=crearPdf("", "");
            if (dataGridView1.Rows.Count > 0)
            {
                if (dataGridView1.SelectedCells.Count > 0)
                {
                    if (actualBitmap != null)
                    {
                        string tipo = "";
                        string numero_documento = "";
                        int rad_exp = -1;
                        int anexo_count = 0;
                        string anexo_count_file = "";
                        string tDocumental = "";
                        int nPaginas = 11;
                        int numInicialHojas = 0;
                        string observacion_cambio = "";
                        string ObservacioneS = "";
                        int NumeroDeHojas = 11;
                        int codTTR = 0;
                        int anex_codigo = 0;
                        string servidor = "ftp://" + ConfigurationManager.AppSettings["FTP_SERVER"] + ConfigurationManager.AppSettings["FTP_P1"] + ConfigurationManager.AppSettings["FTP_ROUTE"] + ConfigurationManager.AppSettings["FTP_P2"];

                        if (dataGridView1.CurrentRow.Cells[0].Value != null)
                        {
                            tipo = dataGridView1.CurrentRow.Cells[0].Value.ToString();
                            if (tipo.Replace(" ", "") == string.Empty)
                            {
                                MessageBox.Show("El registro no especifica un tipo (radicado o expediente)");
                                return;
                            }
                        }
                        else
                        {
                            MessageBox.Show("El registro no especifica un tipo (radicado o expediente)");
                            return;
                        }
                        if (dataGridView1.CurrentRow.Cells[2].Value != null)
                        {
                            numero_documento = dataGridView1.CurrentRow.Cells[2].Value.ToString();
                            if (tipo.Replace(" ", "") == string.Empty)
                            {
                                MessageBox.Show("El registro no especifica un numero de documento");
                                return;
                            }
                        }
                        else
                        {
                            MessageBox.Show("El registro no especifica un numero de documento");
                            return;
                        }

                        if (tipo == "RADICADO")
                            rad_exp = 1;
                        if (tipo == "EXPEDIENTE")
                            rad_exp = 2;

                        int EsAnexo = -1;

                        if (anexarImagenAUnRadicadoToolStripMenuItem.Checked == true && rad_exp == 1)
                            EsAnexo = 1;
                        if (rad_exp == 2)
                            EsAnexo = 1;

                        int tipoDocumentalIndex = -1;
                        string observacion = "";
                        DateTime fechaAnexo = DateTime.Now.AddDays(1);
                        #region ImagenPrincipal
                        if (EsAnexo == -1 && rad_exp == 1)
                        {
                            codTTR = 22;
                            ObservacioneS = " (" + NumeroDeHojas.ToString() + " Paginas)";

                            //Tiene una imagen ya registrada? (base de datos y bodega)
                            string TPSQL = "SELECT RADI_PATH FROM RADICADO WHERE RADI_NUME_RADI=" + numero_documento;
                            string RADI_PATH = string.Empty;
                            OracleConnection con = new OracleConnection(funciones.conni);
                            try
                            {
                                con.Open();
                                OracleCommand command = new OracleCommand(TPSQL, con);
                                using (OracleDataReader reader = command.ExecuteReader())
                                {
                                    if (reader.Read())
                                    {
                                        if (reader[0] != null)
                                            RADI_PATH = reader[0].ToString();
                                        funciones.desconectar(con);
                                    }
                                    else
                                        funciones.desconectar(con);
                                }
                            }
                            catch (Exception)
                            {
                                funciones.desconectar(con);
                            }
                            if (!string.IsNullOrEmpty(RADI_PATH))
                            {
                                var confirmResult = MessageBox.Show("Este radicado ya tiene un documento asociado el archivo será remplazado. Desea continuar ?",
                                                     "Confirmación de reemplazo",
                                                     MessageBoxButtons.YesNo);
                                if (confirmResult == DialogResult.Yes)
                                {
                                    InputBoxResult result = InputBox.Show("Escriba un comentario o la razón. Si no escribe un comentario el envio se cancelara !", "Comentario", string.Empty, 599, 0);
                                    if (result.ReturnCode == DialogResult.OK)
                                    {
                                        observacion_cambio = result.Text;
                                        ObservacioneS = " (" + NumeroDeHojas.ToString() + " Paginas)(" + observacion_cambio + ")";
                                        codTTR = 23;
                                    }
                                    else
                                    {
                                        return;
                                    }
                                }
                                else
                                {
                                    return;
                                }
                            }
                            string queryNumHoj = "select RADI_NUME_HOJA from RADICADO where RADI_NUME_RADI = " + numero_documento;
                            con = new OracleConnection(funciones.conni);
                            try
                            {
                                con.Open();
                                OracleCommand command = new OracleCommand(queryNumHoj, con);
                                using (OracleDataReader reader = command.ExecuteReader())
                                {
                                    if (reader.Read())
                                    {
                                        if (reader[0] != null)
                                            int.TryParse(reader[0].ToString(), out numInicialHojas);
                                        funciones.desconectar(con);
                                    }
                                    else
                                        funciones.desconectar(con);
                                }
                            }
                            catch (Exception)
                            {
                                funciones.desconectar(con);
                            }
                            //Envio de archivo al servidor
                            string imagenf = "";
                            string dirserver = "";
                            string nombrearchivo = numero_documento + ".pdf";
                            int numHojasDigitalizadas = (NumeroDeHojas - numInicialHojas);

                            //lbl_InfoRadicado1.Text = tipo + " No." + numero_documento.Substring(0, 4) + "-" + numero_documento.Substring(4, 3) + "-" + numero_documento.Substring(7, 6) + "-" + numero_documento.Substring(13, 1);
                            imagenf = @"/" + numero_documento.Substring(0, 4) + @"/" + numero_documento.Substring(4, 3) + @"/" + numero_documento + ".pdf";
                            dirserver = @"/" + numero_documento.Substring(0, 4) + @"/" + numero_documento.Substring(4, 3) + @"/";
                            if (sendFile("", "", ""))
                            {
                                //guardar registro
                                string IISQL = "update radicado set RADI_NUME_HOJA=" + NumeroDeHojas + ", radi_path='" + imagenf.Replace(" ", "") + "'  where radi_nume_radi=" + numero_documento;
                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    using (OracleCommand command = new OracleCommand(IISQL, con))
                                    {
                                        int result = command.ExecuteNonQuery();
                                    }
                                    funciones.desconectar(con);
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }

                                string codusdp = usuarioScanOrfeo.DEPE_CODI.ToString().PadLeft(3, '0') + usuarioScanOrfeo.USUA_CODI.ToString().PadLeft(3, '0');
                                string ISQL_HL = "insert into hist_eventos(DEPE_CODI,HIST_FECH,USUA_CODI,RADI_NUME_RADI,HIST_OBSE,USUA_CODI_DEST,USUA_DOC,SGD_TTR_CODIGO,NUM_PAG_DIGIT) values (";
                                ISQL_HL += usuarioScanOrfeo.DEPE_CODI + "," + varFechaSistema + "," + usuarioScanOrfeo.USUA_CODI + "," + numero_documento + ",'" + ObservacioneS + "'," + codusdp + "," + usuarioScanOrfeo.USUA_DOC + "," + codTTR + "," + numHojasDigitalizadas + ")";
                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    using (OracleCommand command = new OracleCommand(ISQL_HL, con))
                                    {
                                        int result = command.ExecuteNonQuery();
                                    }
                                    funciones.desconectar(con);
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }
                                //limpiar controles
                            }




                        }
                        #endregion
                        #region AnexoRadicado
                        if (EsAnexo == 1 && rad_exp == 1)
                        {
                            codTTR = 29;
                            string ISQL_HL = "select anex_codigo,ANEX_NUMERO from anexos where anex_codigo like '" + numero_documento + "%' ORDER BY ANEX_NUMERO DESC";
                            OracleConnection con = new OracleConnection(funciones.conni);
                            try
                            {
                                con.Open();
                                OracleCommand command = new OracleCommand(ISQL_HL, con);
                                using (OracleDataReader reader = command.ExecuteReader())
                                {
                                    if (reader.Read())
                                    {
                                        if (reader[0] != null)
                                        {
                                            int.TryParse(reader[1].ToString(), out anex_codigo);
                                        }
                                        funciones.desconectar(con);
                                    }
                                    else
                                        funciones.desconectar(con);
                                }
                            }
                            catch (Exception)
                            {
                                funciones.desconectar(con);
                            }
                            anex_codigo++;
                            if (cBoxtDocumento.SelectedIndex > 0)
                            {
                                tipoDocumentalIndex = cBoxtDocumento.SelectedIndex;
                                string[] tipoDocumentalSplit = this.cBoxtDocumento.GetItemText(this.cBoxtDocumento.SelectedItem).Split(' ');
                                if (tipoDocumentalSplit != null)
                                {
                                    if (tipoDocumentalSplit.Length > 0)
                                    {
                                        int parse = 0;
                                        if (tipoDocumentalSplit[0] != null)
                                        {
                                            if (int.TryParse(tipoDocumentalSplit[0], out parse))
                                            {
                                                tDocumental = parse.ToString();
                                            }
                                        }
                                    }
                                }
                            }
                            if (tipoDocumentalIndex == -1)
                            {
                                MessageBox.Show("Debe Seleccionar un Tipo de Documental.");
                                return;
                            }
                            if (!string.IsNullOrEmpty(txtObservaciones.Text))
                            {
                                observacion = txtObservaciones.Text;
                            }
                            else
                            {
                                MessageBox.Show("Debe Escribir al menos un caracter en observaciones de anexo.");
                                return;
                            }
                            ObservacioneS = "(" + NumeroDeHojas.ToString() + " Paginas) " + observacion;

                            string imagenf = "";
                            string dirserver = "";
                            string nombrearchivo = numero_documento + "_" + anex_codigo.ToString().PadLeft(5, '0') + ".pdf";

                            //lbl_InfoRadicado1.Text = tipo + " No." + numero_documento.Substring(0, 4) + "-" + numero_documento.Substring(4, 3) + "-" + numero_documento.Substring(7, 6) + "-" + numero_documento.Substring(13, 1);
                            imagenf = @"/" + numero_documento.Substring(0, 4) + @"/" + numero_documento.Substring(4, 3) + @"/docs/" + nombrearchivo;
                            dirserver = @"/" + numero_documento.Substring(0, 4) + @"/" + numero_documento.Substring(4, 3) + @"/docs/";

                            if (sendFile("", "", ""))
                            {
                                string IISQL = "insert into anexos";
                                IISQL = IISQL + "        (sgd_rem_destino,anex_radi_nume ,anex_codigo ,anex_tipo,anex_tamano ,anex_solo_lect,anex_creador ,anex_desc ,anex_numero ,anex_nomb_archivo ,anex_borrado,anex_salida ,sgd_dir_tipo,anex_depe_creador,sgd_tpr_codigo ,anex_fech_anex)";
                                IISQL = IISQL + " values (1 ," + numero_documento + "," + numero_documento + anex_codigo.ToString().PadLeft(5, '0') + ",'4'      ,1000,'n'           ,'" + usuarioScanOrfeo.USUA_LOGIN + "' ,'" + ObservacioneS + "' ,'" + anex_codigo + "','" + nombrearchivo + "','N'         ,'0'         ,'0'         ,'0'              ,'" + tDocumental + "'," + varFechaSistema + ")";

                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    using (OracleCommand command = new OracleCommand(IISQL, con))
                                    {
                                        int result = command.ExecuteNonQuery();
                                    }
                                    funciones.desconectar(con);
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }

                                ObservacioneS = "(" + NumeroDeHojas + " Paginas)" + " (Anexo No. " + anex_codigo.ToString().PadLeft(5, '0') + ") " + observacion + "";
                                string codusdp = usuarioScanOrfeo.DEPE_CODI.ToString().PadLeft(3, '0') + usuarioScanOrfeo.USUA_CODI.ToString().PadLeft(3, '0');
                                ISQL_HL = "insert into hist_eventos(DEPE_CODI,HIST_FECH,USUA_CODI,RADI_NUME_RADI,HIST_OBSE,USUA_CODI_DEST,USUA_DOC,SGD_TTR_CODIGO,NUM_PAG_DIGIT) values (" + numero_documento.Substring(4, 3) + "," + varFechaSistema + "," + usuarioScanOrfeo.USUA_CODI + "," + numero_documento + ",'" + ObservacioneS + "'," + codusdp + "," + usuarioScanOrfeo.USUA_DOC + "," + codTTR + "," + NumeroDeHojas + ")";
                                con = new OracleConnection(funciones.conni);

                                try
                                {
                                    con.Open();
                                    using (OracleCommand command = new OracleCommand(ISQL_HL, con))
                                    {
                                        int result = command.ExecuteNonQuery();
                                    }
                                    funciones.desconectar(con);
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }
                            }
                        }
                        #endregion
                        #region AnexoExpediente
                        if (EsAnexo == 1 && rad_exp == 2)
                        {
                            if (cBoxtDocumento.SelectedIndex > 0)
                            {
                                tipoDocumentalIndex = cBoxtDocumento.SelectedIndex;
                                string[] tipoDocumentalSplit = this.cBoxtDocumento.GetItemText(this.cBoxtDocumento.SelectedItem).Split(' ');
                                if (tipoDocumentalSplit != null)
                                {
                                    if (tipoDocumentalSplit.Length > 0)
                                    {
                                        int parse = 0;
                                        if (tipoDocumentalSplit[0] != null)
                                        {
                                            if (int.TryParse(tipoDocumentalSplit[0], out parse))
                                            {
                                                tDocumental = parse.ToString();
                                            }
                                        }
                                    }
                                }
                            }

                            if (tipoDocumentalIndex == -1)
                            {
                                MessageBox.Show("Debe Seleccionar un Tipo de Documental.");
                                return;
                            }
                            if (!string.IsNullOrEmpty(txtObservaciones.Text))
                            {
                                observacion = txtObservaciones.Text;
                            }
                            else
                            {
                                MessageBox.Show("Debe Escribir al menos un caracter en observaciones de anexo.");
                                return;
                            }
                            fechaAnexo = new DateTime(dtFechaAnexo.Value.Year, dtFechaAnexo.Value.Month, dtFechaAnexo.Value.Day).AddHours(dtHoraAnexo.Value.Hour).AddMinutes(dtHoraAnexo.Value.Minute).AddSeconds(dtHoraAnexo.Value.Second);
                            if (fechaAnexo > DateTime.Now)
                            {
                                MessageBox.Show("La fecha y hora ingresadas deben ser inferiores a la fecha y hora actuales.");
                                return;
                            }
                            string fecha_str = String.Format("{0:yyyy/MM/dd HH:mm:ss}", fechaAnexo);
                            string fecha_str_now = String.Format("{0:yyyy/MM/dd HH:mm:ss}", DateTime.Now);
                            string ISQL_aux_count = " SELECT MAX(SGD_AEX_NUMERO) as MAXIMO FROM SGD_AEX_ANEXOEXPEDIENTE WHERE SGD_AEX_EXPEDIENTE = '" + numero_documento + "' ";

                            OracleConnection con = new OracleConnection(funciones.conni);
                            try
                            {
                                con.Open();
                                OracleCommand command = new OracleCommand(ISQL_aux_count, con);
                                using (OracleDataReader reader = command.ExecuteReader())
                                {
                                    if (reader.Read())
                                    {
                                        if (reader[0] != null)
                                        {
                                            int.TryParse(reader[0].ToString(), out anexo_count);
                                            anexo_count++;
                                            int n = 5 - anexo_count.ToString().Length;
                                            if (n > 0)
                                            {
                                                for (int i = 0; i < n; i++)
                                                {
                                                    anexo_count_file = "0" + anexo_count_file;
                                                }
                                                anexo_count_file += anexo_count.ToString() + ".pdf";
                                            }
                                        }
                                        funciones.desconectar(con);
                                    }
                                    else
                                        funciones.desconectar(con);
                                }

                            }
                            catch (Exception)
                            {
                                funciones.desconectar(con);
                            }
                            //Envio de archivo al servidor
                            //guardar registro

                            if (sendFile("", "", ""))
                            {
                                string ISQL_aux = " INSERT INTO SGD_AEX_ANEXOEXPEDIENTE (SGD_AEX_EXPEDIENTE,SGD_AEX_NUMERO,SGD_AEX_TIPO,SGD_AEX_TAMANO,SGD_AEX_DESCRIPCION,SGD_AEX_ARCHIVO,SGD_AEX_BORRADO,SGD_AEX_FECHA,SGD_AEX_FECHACREACION,SGD_AEX_TRD,SGD_AEX_NUM_HOJAS) VALUES (";
                                ISQL_aux = ISQL_aux + "'" + numero_documento + "'," + anexo_count + ",1,1000, '" + observacion + "'";
                                ISQL_aux = ISQL_aux + ", '" + numero_documento + "_" + anexo_count_file + "','N',TO_DATE('" + fecha_str + "', 'yyyy-mm-dd HH24:mi:ss'),TO_DATE('" + fecha_str_now + "', 'yyyy-mm-dd HH24:mi:ss'),'" + tDocumental + "'," + NumeroDeHojas.ToString() + ")";

                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    using (OracleCommand command = new OracleCommand(ISQL_aux, con))
                                    {
                                        int result = command.ExecuteNonQuery();
                                    }
                                    funciones.desconectar(con);
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }
                                string ISQL_aux1 = " Insert into SGD_HFLD_HISTFLUJODOC (SGD_HFLD_CODIGO,SGD_FEXP_CODIGO,SGD_EXP_FECHFLUJOANT,SGD_HFLD_FECH,SGD_EXP_NUMERO,RADI_NUME_RADI,USUA_DOC,USUA_CODI,DEPE_CODI,SGD_TTR_CODIGO,SGD_FEXP_OBSERVA,SGD_HFLD_OBSERVA,SGD_FARS_CODIGO,SGD_HFLD_AUTOMATICO) values ( ";
                                ISQL_aux1 = ISQL_aux1 + " null,0,null,sysdate,'" + numero_documento + "'," + anexo_count + ",'" + usuarioScanOrfeo.USUA_DOC + "'," + usuarioScanOrfeo.USUA_CODI + "," + usuarioScanOrfeo.DEPE_CODI + ",29,null,'" + "(" + NumeroDeHojas.ToString() + " Paginas) " + observacion + "',null,null)";

                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    using (OracleCommand command = new OracleCommand(ISQL_aux1, con))
                                    {
                                        int result = command.ExecuteNonQuery();
                                    }
                                    funciones.desconectar(con);
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }
                                //limpiar controles
                            }
                            //actualBitmap.Save(@"D:\imgidu\2019\526\docs\imagen.tiff", ImageFormat.Tiff);
                            //byte[] buffer = System.IO.File.ReadAllBytes(@"yourimage.ext");
                            //int size = buffer.Length;
                            ////long jpegByteSize;
                            ////using (var ms = new MemoryStream(actualBitmap)) // estimatedLength can be original fileLength
                            ////{
                            ////    image.Save(ms, ImageFormat.Jpeg); // save image to stream in Jpeg format
                            ////    jpegByteSize = ms.Length;
                            ////}
                        }
                        #endregion
                    }
                    else
                        MessageBox.Show("No existe una imagen a convertir para enviar como PDF/A");
                }
                else
                    MessageBox.Show("Debe seleccionar una registro de radicado o expediente antes de continuar");
            }
            else
                MessageBox.Show("No existen filas seleccionadas, debe realizar la busqueda de un registro y seleccionar una fila");
            return;
        }
        private bool sendFile(string ruta_archivo, string servidor, string ruta_servidor)
        {
            //Enviar archivo si existe
            return true;
            try
            {
                show_loading_panel(361, 174, 414, 36);
                using (var client = new WebClient())
                {
                    client.Credentials = new NetworkCredential(digitalizador_user, digitalizador);
                    client.UploadFile(servidor + ruta_servidor, WebRequestMethods.Ftp.UploadFile, ruta_archivo);
                }
                var request = (FtpWebRequest)WebRequest.Create(servidor + ruta_servidor);
                request.Credentials = new NetworkCredential(digitalizador_user, digitalizador);
                request.Method = WebRequestMethods.Ftp.GetFileSize;

                try
                {
                    FtpWebResponse response = (FtpWebResponse)request.GetResponse();
                    return true;
                }
                catch (WebException ex)
                {
                    FtpWebResponse response = (FtpWebResponse)ex.Response;
                    if (response.StatusCode ==
                        FtpStatusCode.ActionNotTakenFileUnavailable)
                    {
                        MessageBox.Show("El archivo no se subió, por favor vuelva a intentar");
                        return false;
                    }
                }
                hide_loading_panel();
            }
            catch (Exception ex)
            {
                hide_loading_panel();
                MessageBox.Show(ex.ToString());
                return false;
            }
            return false;
        }
        private bool FileFTPExist(string ruta_archivo, string servidor, string ruta_servidor)
        {
            //Enviar archivo si existe
            try
            {
                show_loading_panel(361, 174, 414, 36);
                var request = (FtpWebRequest)WebRequest.Create(servidor + ruta_servidor);
                request.Credentials = new NetworkCredential(digitalizador_user, digitalizador);
                request.Method = WebRequestMethods.Ftp.GetFileSize;

                try
                {
                    FtpWebResponse response = (FtpWebResponse)request.GetResponse();
                    hide_loading_panel();
                    return true;
                }
                catch (WebException ex)
                {
                    try
                    {
                        FtpWebResponse response = (FtpWebResponse)ex.Response;
                        if (response.StatusCode ==
                            FtpStatusCode.ActionNotTakenFileUnavailable)
                        {
                            hide_loading_panel();
                            MessageBox.Show(response.StatusCode.ToString());
                            return false;
                        }
                        else
                        {
                            MessageBox.Show("1");
                            hide_loading_panel();
                        }
                    }
                    catch (Exception ex1)
                    {
                        MessageBox.Show(ex1.ToString());
                        hide_loading_panel();
                    }
                }
            }
            catch (Exception ex)
            {
                hide_loading_panel();
                MessageBox.Show(ex.ToString());
                return false;
            }
            return false;
        }
        private string crearPdf(string rutaInicial, string rutaFinal)
        {
            rutaInicial = @"D:\20195261123992_00002.tif";
            rutaFinal = @"D:\hello_A1-b_cs.pdf";
            Document doc = new Document(PageSize.LETTER);
            doc.SetMargins(0, 0, 0, 0);
            PdfWriter writer = PdfWriter.GetInstance(doc, new FileStream(rutaFinal, FileMode.Create));
            writer.PDFXConformance = PdfWriter.PDFA1B;
            doc.Open();

            PdfDictionary outi = new PdfDictionary(PdfName.OUTPUTINTENT);
            outi.Put(PdfName.OUTPUTCONDITIONIDENTIFIER, new PdfString("sRGB IEC61966-2.1"));
            outi.Put(PdfName.INFO, new PdfString("sRGB IEC61966-2.1"));
            outi.Put(PdfName.S, PdfName.GTS_PDFA1);

            //Perfiles icc
            var path = System.IO.Path.GetDirectoryName(System.Reflection.Assembly.GetExecutingAssembly().CodeBase);
            path = path.Replace("file:\\", "");
            ICC_Profile icc = ICC_Profile.GetInstance(path+ @"\fuentes\sRGB_v4.icc");
            PdfICCBased ib = new PdfICCBased(icc);
            ib.Remove(PdfName.ALTERNATE);
            outi.Put(PdfName.DESTOUTPUTPROFILE, writer.AddToBody(ib).IndirectReference);

            writer.ExtraCatalog.Put(PdfName.OUTPUTINTENTS, new PdfArray(outi));

            BaseFont bf = BaseFont.CreateFont(path+@"\fuentes\arial.ttf", BaseFont.WINANSI, true);
            iTextSharp.text.Font f = new iTextSharp.text.Font(bf, 12);

            //Captar la ruta de imagenes del radicado, si existe: usar sus imagenes
            System.Drawing.Bitmap bm = new System.Drawing.Bitmap(rutaInicial);
            int total = bm.GetFrameCount(System.Drawing.Imaging.FrameDimension.Page);

            //Crear las paginas
            for (int i = 0; i < total; ++i)
            {
                doc.NewPage();
                float subtrahend = doc.PageSize.Height - 10;
                bm.SelectActiveFrame(System.Drawing.Imaging.FrameDimension.Page, i);
                iTextSharp.text.Image pool = iTextSharp.text.Image.GetInstance(bm, ImageFormat.Tiff);
                pool.Alignment = 3;
                pool.ScaleToFit(doc.PageSize.Width - (doc.RightMargin * 2), subtrahend);
                doc.Add(pool);
            }

            writer.CreateXmpMetadata();
            doc.Close();
            garbage_collector();
            return "";
        }
        private void btnBorrarSeleccion_Click(object sender, EventArgs e)
        {
            if (PageEdit.Image != null && Rect.X > 0 && Rect.Y > 0)
            {
                using (Bitmap bitmap = new Bitmap(Width, Height))
                using (Graphics graphics = Graphics.FromImage(TiffCarga[0]))
                {
                    System.Drawing.Rectangle rect = new System.Drawing.Rectangle(0, 0, Width, Height);
                    graphics.FillRectangle(new SolidBrush(System.Drawing.Color.White), Rect);
                    Invalidate();
                    PageEdit.Refresh();
                }
            }
        }



        private void ScanOrfeo_KeyUp(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Left)
                btnPrevScreen_Click(null, null);
            if (e.KeyCode == Keys.Right)
                btnNextScreen_Click(null, null);


        }



        private void txtPage_KeyPress(object sender, KeyPressEventArgs e)
        {
            if (Char.IsLetter(e.KeyChar))
            {
                e.Handled = true;
            }
            else if (Char.IsControl(e.KeyChar))
            {
                e.Handled = false;
            }
            else if (Char.IsSeparator(e.KeyChar))
            {
                e.Handled = false;
            }
            else if (Char.IsDigit(e.KeyChar))
            {
                e.Handled = false;
            }
            else
            {
                e.Handled = true;
            }
        }

        private void txtPage_KeyUp(object sender, KeyEventArgs e)
        {
            int page;
            if (int.TryParse(txtPage.Text.Replace(" ", ""), out page))
            {
                if (TiffCarga.Count >= page && TiffCarga.Count > 0)
                {
                    pageRange[0] = page - 1;
                    pageRange[1] += 2;
                    cargarImagen1(pageRange);
                }
            }
        }

        #region impresion_etiquetas
        private void button2_Click(object sender, EventArgs e)
        {
            ListaEtiquetas = new List<model.etiquetas>();
            if (!imprimirSoloStickerToolStripMenuItem.Checked)
            {
                #region todas_las_filas_etiquetas
                if (dataGridView1.Rows.Count > 0)
                {
                    foreach (DataGridViewRow dgvRenglon in dataGridView1.Rows)
                    {
                        string tipo = "";
                        string numero_documento = "";
                        string tipo_rem = "";
                        string fecha = "";
                        string dependencia = "";
                        int OEM = 0;
                        int ESP = 0;
                        int CIU = 0;
                        string FUN = "";
                        string remitente = "";
                        string nombre_dep = "";
                        string anex_desc = "";
                        string novedad = "";

                        if (dgvRenglon.Cells[0].Value != null)
                            tipo = dgvRenglon.Cells[0].Value.ToString();
                        if (dgvRenglon.Cells[2].Value != null)
                            numero_documento = dgvRenglon.Cells[2].Value.ToString();

                        if (!string.IsNullOrEmpty(tipo) && !string.IsNullOrEmpty(numero_documento))
                        {
                            string IISQL = "Select a.SGD_CIU_CODIGO,a.SGD_ESP_CODI,a.SGD_OEM_CODIGO,a.SGD_DOC_FUN, r.RADI_DESC_ANEX from sgd_dir_drecciones a, radicado r where a.radi_nume_radi=r.radi_nume_radi and a.radi_nume_radi=" + numero_documento;
                            IISQL = IISQL + " ORDER BY SGD_DIR_TIPO  ";
                            OracleConnection con = new OracleConnection(funciones.conni);
                            try
                            {
                                con.Open();
                                OracleCommand command = new OracleCommand(IISQL, con);
                                using (OracleDataReader reader = command.ExecuteReader())
                                {
                                    if (reader.Read())
                                    {
                                        if (int.TryParse(reader[0].ToString(), out CIU))
                                            FUN = "";
                                        if (int.TryParse(reader[1].ToString(), out ESP))
                                            FUN = "";
                                        if (int.TryParse(reader[2].ToString(), out OEM))
                                            FUN = "";
                                        if (reader[3] != null)
                                        {
                                            FUN = reader[3].ToString();
                                        }
                                        if (reader[4] != null)
                                        {
                                            anex_desc = reader[4].ToString();
                                        }
                                        funciones.desconectar(con);
                                    }
                                    else
                                        funciones.desconectar(con);
                                }

                            }
                            catch (Exception)
                            {
                                funciones.desconectar(con);
                            }
                            if (tipo == "RADICADO")
                            {
                                if (dgvRenglon.Cells[3].Value != null)
                                    fecha = dgvRenglon.Cells[3].Value.ToString();
                                if (dgvRenglon.Cells[5].Value != null)
                                    dependencia = dgvRenglon.Cells[5].Value.ToString();

                                if (OEM > 0)
                                {
                                    IISQL = "Select a.sgd_oem_oempresa REMITENTE from SGD_OEM_OEMPRESAS a where a.SGD_OEM_CODIGO=" + OEM.ToString();
                                    tipo_rem += "(OEM) ";
                                }
                                if (CIU > 0)
                                {
                                    IISQL = "Select a.sgd_ciu_nombre || a.sgd_ciu_apell1 || sgd_ciu_apell2 REMITENTE from SGD_CIU_CIUDADANO a where a.sgd_ciu_codigo=" + CIU.ToString();
                                    tipo_rem += "(CIU) ";
                                }
                                if (ESP > 0)
                                {
                                    IISQL = "Select a.SIGLA_DE_LA_EMPRESA || '-' || a.NOMBRE_DE_LA_EMPRESA REMITENTE from BODEGA_EMPRESAS a where a.IDENTIFICADOR_EMPRESA=" + ESP.ToString();
                                    tipo_rem += "(ESP) ";
                                }
                                if (FUN != string.Empty)
                                {
                                    IISQL = "Select substr(USUA_NOMB,0,20) || '-' || DEPE_CODI REMITENTE from USUARIO a where a.usua_doc='" + FUN + "'";
                                    tipo_rem += "(FUN) ";
                                }

                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    OracleCommand command = new OracleCommand(IISQL, con);
                                    using (OracleDataReader reader = command.ExecuteReader())
                                    {
                                        if (reader.Read())
                                        {
                                            if (reader[0] != null)
                                                remitente = reader[0].ToString();
                                            funciones.desconectar(con);
                                        }
                                        else
                                            funciones.desconectar(con);
                                    }
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }

                                IISQL = "Select par_serv_nombre from radicado r, par_serv_servicios p where p.par_serv_secue = r.par_serv_secue and r.radi_nume_radi = " + numero_documento;
                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    OracleCommand command = new OracleCommand(IISQL, con);
                                    using (OracleDataReader reader = command.ExecuteReader())
                                    {
                                        if (reader.Read())
                                        {
                                            if (reader[0] != null)
                                                novedad = reader[0].ToString();
                                            funciones.desconectar(con);
                                        }
                                        else
                                            funciones.desconectar(con);
                                    }
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }

                                IISQL = "SELECT DEPE_NOMB FROM dependencia where DEPE_CODI=" + dependencia;
                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    OracleCommand command = new OracleCommand(IISQL, con);
                                    using (OracleDataReader reader = command.ExecuteReader())
                                    {
                                        if (reader.Read())
                                        {
                                            if (reader[0] != null)
                                                nombre_dep = reader[0].ToString();
                                            funciones.desconectar(con);
                                        }
                                        else
                                            funciones.desconectar(con);

                                    }



                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }

                                string fechaRad = string.Format(fecha, "dd/mm/yyyy hh:mm AMPM");
                                tipo_rem += remitente;
                                codbarras_private = generarCodigoBarras_sinver(numero_documento);

                                tipo_rem = tipo_rem.Replace("DIRECCION", "DIR");
                                tipo_rem = tipo_rem.Replace("DEPENDENCIA", "DEP");
                                tipo_rem = tipo_rem.Replace("OFICINA", "OFIC");
                                tipo_rem = tipo_rem.Replace("SUPERINTENDENCIA", "SUP");

                                nombre_dep = nombre_dep.Replace("DIRECCION", "DIR");
                                nombre_dep = nombre_dep.Replace("DEPENDENCIA", "DEP");
                                nombre_dep = nombre_dep.Replace("OFICINA", "OFIC");
                                nombre_dep = nombre_dep.Replace("SUPERINTENDENCIA", "SUP");

                                if (anex_desc.Length >= 58)
                                    anex_desc = anex_desc.Substring(0, 58);
                                else
                                    anex_desc = anex_desc.Substring(0, anex_desc.Length);
                                anex_desc = anex_desc.Replace(System.Environment.NewLine, " ");

                                etiquetas etiquetas = new etiquetas();
                                etiquetas.LINEA1 = "No. " + numero_documento + " de "+ fechaRad;
                                etiquetas.LINEA2 = "Remite: " + tipo_rem;
                                etiquetas.LINEA3 = "Dep.: " + nombre_dep;
                                etiquetas.LINEA4 = "Anexos: " + anex_desc;
                                etiquetas.LINEA5 = "Novedad: " + novedad;

                                ListaEtiquetas.Add(etiquetas);
                            }
                            else if (tipo == "EXPEDIENTE")
                            {
                                
                            }
                        }
                    }
                    if (ListaEtiquetas.Count>0)
                        print();
                }
                #endregion
            }
            else
            {
                #region solo_fila_seleccionada
                if (dataGridView1.Rows.Count > 0)
                {

                        string tipo = "";
                        string numero_documento = "";
                        string tipo_rem = "";
                        string fecha = "";
                        string dependencia = "";
                        int OEM = 0;
                        int ESP = 0;
                        int CIU = 0;
                        string FUN = "";
                        string remitente = "";
                        string nombre_dep = "";
                        string anex_desc = "";
                        string novedad = "";

                        if (dataGridView1.CurrentRow.Cells[0].Value != null)
                            tipo = dataGridView1.CurrentRow.Cells[0].Value.ToString();
                        if (dataGridView1.CurrentRow.Cells[2].Value != null)
                            numero_documento = dataGridView1.CurrentRow.Cells[2].Value.ToString();

                        if (!string.IsNullOrEmpty(tipo) && !string.IsNullOrEmpty(numero_documento))
                        {
                            string IISQL = "Select a.SGD_CIU_CODIGO,a.SGD_ESP_CODI,a.SGD_OEM_CODIGO,a.SGD_DOC_FUN, r.RADI_DESC_ANEX from sgd_dir_drecciones a, radicado r where a.radi_nume_radi=r.radi_nume_radi and a.radi_nume_radi=" + numero_documento;
                            IISQL = IISQL + " ORDER BY SGD_DIR_TIPO  ";
                            OracleConnection con = new OracleConnection(funciones.conni);
                            try
                            {
                                con.Open();
                                OracleCommand command = new OracleCommand(IISQL, con);
                                OracleDataReader reader = command.ExecuteReader();
                                if (reader.Read())
                                {
                                    if (int.TryParse(reader[0].ToString(), out CIU))
                                        FUN = "";
                                    if (int.TryParse(reader[1].ToString(), out ESP))
                                        FUN = "";
                                    if (int.TryParse(reader[2].ToString(), out OEM))
                                        FUN = "";
                                    if (reader[3] != null)
                                    {
                                        FUN = reader[3].ToString();
                                    }
                                    if (reader[4] != null)
                                    {
                                        anex_desc = reader[4].ToString();
                                    }
                                    funciones.desconectar(con);
                                }
                                else
                                    funciones.desconectar(con);
                            }
                            catch (Exception)
                            {
                                funciones.desconectar(con);
                            }
                            if (tipo == "RADICADO")
                            {
                                if (dataGridView1.CurrentRow.Cells[3].Value != null)
                                    fecha = dataGridView1.CurrentRow.Cells[3].Value.ToString();
                                if (dataGridView1.CurrentRow.Cells[5].Value != null)
                                    dependencia = dataGridView1.CurrentRow.Cells[5].Value.ToString();

                                if (OEM > 0)
                                {
                                    IISQL = "Select a.sgd_oem_oempresa REMITENTE from SGD_OEM_OEMPRESAS a where a.SGD_OEM_CODIGO=" + OEM.ToString();
                                    tipo_rem += "(OEM) ";
                                }
                                if (CIU > 0)
                                {
                                    IISQL = "Select a.sgd_ciu_nombre || a.sgd_ciu_apell1 || sgd_ciu_apell2 REMITENTE from SGD_CIU_CIUDADANO a where a.sgd_ciu_codigo=" + CIU.ToString();
                                    tipo_rem += "(CIU) ";
                                }
                                if (ESP > 0)
                                {
                                    IISQL = "Select a.SIGLA_DE_LA_EMPRESA || '-' || a.NOMBRE_DE_LA_EMPRESA REMITENTE from BODEGA_EMPRESAS a where a.IDENTIFICADOR_EMPRESA=" + ESP.ToString();
                                    tipo_rem += "(ESP) ";
                                }
                                if (FUN != string.Empty)
                                {
                                    IISQL = "Select substr(USUA_NOMB,0,20) || '-' || DEPE_CODI REMITENTE from USUARIO a where a.usua_doc='" + FUN + "'";
                                    tipo_rem += "(FUN) ";
                                }

                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    OracleCommand command = new OracleCommand(IISQL, con);
                                    OracleDataReader reader = command.ExecuteReader();
                                    if (reader.Read())
                                    {
                                        if (reader[0] != null)
                                            remitente = reader[0].ToString();
                                        funciones.desconectar(con);
                                    }
                                    else
                                        funciones.desconectar(con);
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }

                                IISQL = "Select par_serv_nombre from radicado r, par_serv_servicios p where p.par_serv_secue = r.par_serv_secue and r.radi_nume_radi = " + numero_documento;
                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    OracleCommand command = new OracleCommand(IISQL, con);
                                    OracleDataReader reader = command.ExecuteReader();
                                    if (reader.Read())
                                    {
                                        if (reader[0] != null)
                                            novedad = reader[0].ToString();
                                        funciones.desconectar(con);
                                    }
                                    else
                                        funciones.desconectar(con);
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }

                                IISQL = "SELECT DEPE_NOMB FROM dependencia where DEPE_CODI=" + dependencia;
                                con = new OracleConnection(funciones.conni);
                                try
                                {
                                    con.Open();
                                    OracleCommand command = new OracleCommand(IISQL, con);
                                    OracleDataReader reader = command.ExecuteReader();
                                    if (reader.Read())
                                    {
                                        if (reader[0] != null)
                                            nombre_dep = reader[0].ToString();
                                        funciones.desconectar(con);
                                    }
                                    else
                                        funciones.desconectar(con);
                                }
                                catch (Exception)
                                {
                                    funciones.desconectar(con);
                                }

                                string fechaRad = string.Format(fecha, "dd/mm/yyyy hh:mm AMPM");
                                tipo_rem += remitente;
                                codbarras_private = generarCodigoBarras_sinver(numero_documento);

                                tipo_rem = tipo_rem.Replace("DIRECCION", "DIR");
                                tipo_rem = tipo_rem.Replace("DEPENDENCIA", "DEP");
                                tipo_rem = tipo_rem.Replace("OFICINA", "OFIC");
                                tipo_rem = tipo_rem.Replace("SUPERINTENDENCIA", "SUP");

                                nombre_dep = nombre_dep.Replace("DIRECCION", "DIR");
                                nombre_dep = nombre_dep.Replace("DEPENDENCIA", "DEP");
                                nombre_dep = nombre_dep.Replace("OFICINA", "OFIC");
                                nombre_dep = nombre_dep.Replace("SUPERINTENDENCIA", "SUP");

                                if (anex_desc.Length >= 58)
                                    anex_desc = anex_desc.Substring(0, 58);
                                else
                                    anex_desc = anex_desc.Substring(0, anex_desc.Length);
                                anex_desc = anex_desc.Replace(System.Environment.NewLine, " ");

                                etiquetas etiquetas = new etiquetas();
                                etiquetas.LINEA1 = "No. " + numero_documento + " de " + fechaRad;
                                etiquetas.LINEA2 = "Remite: " + tipo_rem;
                                etiquetas.LINEA3 = "Dep.: " + nombre_dep;
                                etiquetas.LINEA4 = "Anexos: " + anex_desc;
                                etiquetas.LINEA5 = "Novedad: " + novedad;

                                ListaEtiquetas.Add(etiquetas);
                            }
                            else if (tipo == "EXPEDIENTE")
                            {

                            }
                        
                    }
                    if (ListaEtiquetas.Count > 0)
                        print();
                }
                #endregion
            }
        }
        public void print()
        {
            PrintPage = 0;
            try
            {
                PrintDialog pd = new PrintDialog();
                string strDefaultPrinter = pd.PrinterSettings.PrinterName; 
                pdoc = new PrintDocument();
                PrinterSettings ps = new PrinterSettings();
                System.Drawing.Font font = new System.Drawing.Font("Courier New", 15);
                PaperSize psize = new PaperSize("Custom", 303, 98);
                pd.Document = pdoc;
                pd.Document.DefaultPageSettings.PaperSize = psize;
                pdoc.PrintPage += new PrintPageEventHandler(pdoc_PrintPage);

                string defaultPrinterName = ps.PrinterName;
                if (defaultPrinterName == "POSTEK G-3106")
                {
                    ps.PrinterName = "POSTEK G-3106";
                    pd.PrinterSettings.PrinterName = "POSTEK G-3106";
                }
                else
                {
                    ps.PrinterName = defaultPrinterName;
                    pd.PrinterSettings.PrinterName = defaultPrinterName;
                }
                DialogResult result = pd.ShowDialog();
                if (result == DialogResult.OK)
                {
                    pdoc.Print();
                }
            }
            catch (Exception)
            {
            }
        }
        void pdoc_PrintPage(object sender, PrintPageEventArgs e)
        {
            System.Drawing.Font fuente1 = new System.Drawing.Font("Arial", 8, FontStyle.Bold);
            System.Drawing.Font fuente2 = new System.Drawing.Font("Arial", 7, FontStyle.Bold);

            int startX = 5;
            int startY = 2;
            int Offset = 2;
            
            byte[] imageBytes = Convert.FromBase64String(base64);
            System.Drawing.Image img;
            using (var ms = new MemoryStream(imageBytes, 0, imageBytes.Length))
            {
                img = System.Drawing.Image.FromStream(ms, true);
            }
                e.Graphics.DrawImage(img, new System.Drawing.Rectangle(startX + 5, startY + Offset, 69, 28));
                e.Graphics.DrawImage(codbarras_private, new System.Drawing.Rectangle(80, startY + Offset, 300, 28));

                Offset += 31;
                e.Graphics.DrawString(ListaEtiquetas[PrintPage].LINEA1, fuente1, new SolidBrush(System.Drawing.Color.Black), startX, startY + Offset);
                Offset += 11;
                e.Graphics.DrawString(ListaEtiquetas[PrintPage].LINEA2, fuente1, new SolidBrush(System.Drawing.Color.Black), startX, startY + Offset);
                Offset += 11;
                e.Graphics.DrawString(ListaEtiquetas[PrintPage].LINEA3, fuente2, new SolidBrush(System.Drawing.Color.Black), startX, startY + Offset);
                Offset += 11;
                e.Graphics.DrawString(ListaEtiquetas[PrintPage].LINEA4, fuente2, new SolidBrush(System.Drawing.Color.Black), startX, startY + Offset);
                Offset += 11;
                e.Graphics.DrawString(ListaEtiquetas[PrintPage].LINEA5, fuente2, new SolidBrush(System.Drawing.Color.Black), startX, startY + Offset);
                Offset = 0;
            PrintPage++;
            if (PrintPage + 1<=ListaEtiquetas.Count)
            {
                e.HasMorePages = true;
            }
        }
        #endregion
        private void button1_Click_1(object sender, EventArgs e)
        {
            
        }

        private void button3_Click_1(object sender, EventArgs e)
        {
            limpiar_imagen();
        }

        private void lblScreen1_Click(object sender, EventArgs e)
        {

        }

        private void btnLimpiarAnexo_Click(object sender, EventArgs e)
        {
            limpiar_anexos();
        }

        private void dataGridView1_CellLeave(object sender, DataGridViewCellEventArgs e)
        {
            
        }

        private void anexarImagenAUnRadicadoToolStripMenuItem_CheckedChanged(object sender, EventArgs e)
        {
            string tipo = "";
            lblTipoEnvio.Text = "";
            if (dataGridView1.Rows.Count > 0)
            {
                if (dataGridView1.CurrentRow.Cells[0].Value != null)
                {
                    tipo = dataGridView1.CurrentRow.Cells[0].Value.ToString();
                }
                if (tipo!="")
                {
                    if (tipo == "RADICADO")
                    {
                        if (anexarImagenAUnRadicadoToolStripMenuItem.Checked)
                        {
                            btnEnviarPDF1.FlatAppearance.BorderColor = System.Drawing.Color.Red;
                            btnEnviarPDF1.FlatAppearance.BorderSize = 2;
                            lblTipoEnvio.Text = "Anexo de Radicado";
                        }
                        else
                        {
                            btnEnviarPDF1.FlatAppearance.BorderColor = System.Drawing.Color.Blue;
                            btnEnviarPDF1.FlatAppearance.BorderSize = 2;
                            lblTipoEnvio.Text = "Documento Principal de Radicado";
                        }
                    }
                    if (tipo == "EXPEDIENTE")
                    {
                        btnEnviarPDF1.FlatAppearance.BorderColor = System.Drawing.Color.Black;
                        btnEnviarPDF1.FlatAppearance.BorderSize = 2;
                        lblTipoEnvio.Text = "Anexo de Expediente";
                    }
                }

            }
            
        }

        private void dataGridView1_DataSourceChanged(object sender, EventArgs e)
        {
            
        }
    }

    public class InputBoxResult
    {
        public DialogResult ReturnCode;
        public string Text;
    }
    public class InputBox
    {

        #region Private Windows Contols and Constructor

        // Create a new instance of the form.
        private static Form frmInputDialog;
        private static Label lblPrompt;
        private static Button btnOK;
        private static Button btnCancel;
        private static TextBox txtInput;

        public InputBox()
        {
        }

        #endregion

        #region Private Variables

        private static string _formCaption = string.Empty;
        private static string _formPrompt = string.Empty;
        private static InputBoxResult _outputResponse = new InputBoxResult();
        private static string _defaultValue = string.Empty;
        private static int _xPos = -1;
        private static int _yPos = -1;

        #endregion

        #region Windows Form code

        private static void InitializeComponent()
        {
            // Create a new instance of the form.
            frmInputDialog = new Form();
            lblPrompt = new Label();
            btnOK = new Button();
            btnCancel = new Button();
            txtInput = new TextBox();
            frmInputDialog.SuspendLayout();
            // 
            // lblPrompt
            // 
            lblPrompt.Anchor = ((AnchorStyles)((((AnchorStyles.Top | AnchorStyles.Bottom) | AnchorStyles.Left) | AnchorStyles.Right)));
            lblPrompt.BackColor = SystemColors.Control;
            lblPrompt.Font = new System.Drawing.Font("Microsoft Sans Serif", 8.25F, FontStyle.Regular, GraphicsUnit.Point, ((Byte)(0)));
            lblPrompt.Location = new Point(12, 9);
            lblPrompt.Name = "lblPrompt";
            lblPrompt.Size = new Size(302, 82);
            lblPrompt.TabIndex = 3;
            // 
            // btnOK
            // 
            btnOK.DialogResult = DialogResult.OK;
            btnOK.FlatStyle = FlatStyle.Popup;
            btnOK.Location = new Point(326, 8);
            btnOK.Name = "btnOK";
            btnOK.Size = new Size(64, 24);
            btnOK.TabIndex = 1;
            btnOK.Text = "&OK";
            btnOK.Click += new EventHandler(btnOK_Click);
            // 
            // btnCancel
            // 
            btnCancel.DialogResult = DialogResult.Cancel;
            btnCancel.FlatStyle = FlatStyle.Popup;
            btnCancel.Location = new Point(326, 40);
            btnCancel.Name = "btnCancel";
            btnCancel.Size = new Size(64, 24);
            btnCancel.TabIndex = 2;
            btnCancel.Text = "&Cancel";
            btnCancel.Click += new EventHandler(btnCancel_Click);
            // 
            // txtInput
            // 
            txtInput.Location = new Point(8, 100);
            txtInput.Name = "txtInput";
            txtInput.Size = new Size(379, 20);
            txtInput.TabIndex = 0;
            txtInput.Text = "";
            // 
            // InputBoxDialog
            // 
            frmInputDialog.AutoScaleBaseSize = new Size(5, 13);
            frmInputDialog.ClientSize = new Size(398, 128);
            frmInputDialog.Controls.Add(txtInput);
            frmInputDialog.Controls.Add(btnCancel);
            frmInputDialog.Controls.Add(btnOK);
            frmInputDialog.Controls.Add(lblPrompt);
            frmInputDialog.FormBorderStyle = FormBorderStyle.FixedDialog;
            frmInputDialog.MaximizeBox = false;
            frmInputDialog.MinimizeBox = false;
            frmInputDialog.Name = "InputBoxDialog";
            frmInputDialog.ResumeLayout(false);
        }

        #endregion

        #region Private function, InputBox Form move and change size

        static private void LoadForm()
        {
            OutputResponse.ReturnCode = DialogResult.Ignore;
            OutputResponse.Text = string.Empty;

            txtInput.Text = _defaultValue;
            lblPrompt.Text = _formPrompt;
            frmInputDialog.Text = _formCaption;

            // Retrieve the working rectangle from the Screen class
            // using the PrimaryScreen and the WorkingArea properties.
            System.Drawing.Rectangle workingRectangle = Screen.PrimaryScreen.WorkingArea;

            if ((_xPos >= 0 && _xPos < workingRectangle.Width - 100) && (_yPos >= 0 && _yPos < workingRectangle.Height - 100))
            {
                frmInputDialog.StartPosition = FormStartPosition.Manual;
                frmInputDialog.Location = new System.Drawing.Point(_xPos, _yPos);
            }
            else
                frmInputDialog.StartPosition = FormStartPosition.CenterScreen;


            string PrompText = lblPrompt.Text;

            int n = 0;
            int Index = 0;
            while (PrompText.IndexOf("\n", Index) > -1)
            {
                Index = PrompText.IndexOf("\n", Index) + 1;
                n++;
            }

            if (n == 0)
                n = 1;

            System.Drawing.Point Txt = txtInput.Location;
            Txt.Y = Txt.Y + (n * 4);
            txtInput.Location = Txt;
            System.Drawing.Size form = frmInputDialog.Size;
            form.Height = form.Height + (n * 4);
            frmInputDialog.Size = form;

            txtInput.SelectionStart = 0;
            txtInput.SelectionLength = txtInput.Text.Length;
            txtInput.Focus();
        }

        #endregion

        #region Button control click event

        static private void btnOK_Click(object sender, System.EventArgs e)
        {
            OutputResponse.ReturnCode = DialogResult.OK;
            OutputResponse.Text = txtInput.Text;
            frmInputDialog.Dispose();
        }

        static private void btnCancel_Click(object sender, System.EventArgs e)
        {
            OutputResponse.ReturnCode = DialogResult.Cancel;
            OutputResponse.Text = string.Empty; //Clean output response
            frmInputDialog.Dispose();
        }

        #endregion

        #region Public Static Show functions

        static public InputBoxResult Show(string Prompt)
        {
            InitializeComponent();
            FormPrompt = Prompt;

            // Display the form as a modal dialog box.
            LoadForm();
            frmInputDialog.ShowDialog();
            return OutputResponse;
        }

        static public InputBoxResult Show(string Prompt, string Title)
        {
            InitializeComponent();

            FormCaption = Title;
            FormPrompt = Prompt;

            // Display the form as a modal dialog box.
            LoadForm();
            frmInputDialog.ShowDialog();
            return OutputResponse;
        }

        static public InputBoxResult Show(string Prompt, string Title, string Default)
        {
            InitializeComponent();

            FormCaption = Title;
            FormPrompt = Prompt;
            DefaultValue = Default;

            // Display the form as a modal dialog box.
            LoadForm();
            frmInputDialog.ShowDialog();
            return OutputResponse;
        }

        static public InputBoxResult Show(string Prompt, string Title, string Default, int XPos, int YPos)
        {
            InitializeComponent();
            FormCaption = Title;
            FormPrompt = Prompt;
            DefaultValue = Default;
            XPosition = XPos;
            YPosition = YPos;

            // Display the form as a modal dialog box.
            LoadForm();
            frmInputDialog.ShowDialog();
            return OutputResponse;
        }

        #endregion

        #region Private Properties

        static private string FormCaption
        {
            set
            {
                _formCaption = value;
            }
        } // property FormCaption

        static private string FormPrompt
        {
            set
            {
                _formPrompt = value;
            }
        } // property FormPrompt

        static private InputBoxResult OutputResponse
        {
            get
            {
                return _outputResponse;
            }
            set
            {
                _outputResponse = value;
            }
        } // property InputResponse

        static private string DefaultValue
        {
            set
            {
                _defaultValue = value;
            }
        } // property DefaultValue

        static private int XPosition
        {
            set
            {
                if (value >= 0)
                    _xPos = value;
            }
        } // property XPos

        static private int YPosition
        {
            set
            {
                if (value >= 0)
                    _yPos = value;
            }
        } // property YPos

        #endregion
    }
}
